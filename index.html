<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Sari's Quest">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#FF7EB3">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icon-180.png">
<link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
<link rel="icon" sizes="192x192" href="/icon-192.png">
<title>Sari's Sound Quest</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{font-family:'Fredoka',sans-serif;background:linear-gradient(180deg,#FFD6EC,#FFF0F8,#FFD6EC);color:#4A2040;overflow-x:hidden;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;min-height:100vh;min-height:100dvh;overscroll-behavior:none;-webkit-overflow-scrolling:touch;position:fixed;width:100%;height:100%}
button{font-family:'Fredoka',sans-serif;border:none;cursor:pointer;-webkit-appearance:none;color:#4A2040;touch-action:manipulation}
input{font-family:'Fredoka',sans-serif;touch-action:manipulation}
#root{min-height:100vh;min-height:100dvh;height:100%;overflow-y:auto;overscroll-behavior:none;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
@keyframes confettiFall{0%{opacity:1;transform:translateY(0) rotate(0)}100%{opacity:0;transform:translateY(100vh) rotate(720deg)}}
@keyframes megaFall{0%{opacity:1;transform:translateY(0) rotate(0) scale(1)}50%{opacity:1}100%{opacity:0;transform:translateY(100vh) rotate(720deg) scale(.5)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,59,139,.3)}50%{box-shadow:0 0 35px rgba(255,59,139,.5)}}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounceIn{0%{opacity:0;transform:scale(.3)}50%{transform:scale(1.12)}100%{opacity:1;transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
@keyframes sparkle{0%,100%{opacity:.3;transform:scale(.7)}50%{opacity:1;transform:scale(1.3)}}
@keyframes heartFloat{0%{opacity:0;transform:translateY(0) scale(.5)}20%{opacity:.6}80%{opacity:.4}100%{opacity:0;transform:translateY(-80vh) scale(1) rotate(15deg)}}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
@keyframes rainbowBg{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes popIn{0%{opacity:0;transform:scale(0)}70%{transform:scale(1.15)}100%{opacity:1;transform:scale(1)}}
@keyframes letterSmash{0%{opacity:0;transform:translateX(var(--sx,0)) scale(1.6)}60%{opacity:1;transform:translateX(0) scale(1.1)}80%{transform:translateX(0) scale(.95)}100%{transform:translateX(0) scale(1)}}
@keyframes stickerPop{0%{opacity:0;transform:scale(0) rotate(-20deg)}60%{transform:scale(1.3) rotate(5deg)}100%{opacity:1;transform:scale(1) rotate(0)}}
@keyframes starPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15);filter:brightness(1.3)}}
@keyframes starFly{0%{opacity:1;transform:translateY(0) scale(1)}50%{opacity:1;transform:translateY(-60px) scale(1.4)}100%{opacity:0;transform:translateY(-120px) scale(.5)}}
button:active{transform:scale(.95)!important;transition:transform .1s ease!important}
.quest-btn{transition:transform .2s ease,filter .2s ease,box-shadow .2s ease}
.quest-btn:hover{transform:scale(1.03)!important;filter:brightness(1.15)!important;box-shadow:0 12px 45px rgba(255,59,139,.5)!important}
.mode-btn{transition:transform .2s ease,filter .2s ease,border-color .2s ease}
.mode-btn:hover{transform:scale(1.08)!important;filter:brightness(1.25)!important}
</style>
</head>
<body>
<div id="root"></div>
<div id="loader" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#FFD6EC,#FFF0F8);z-index:9999">
<div style="text-align:center;font-family:sans-serif;color:#C050A0"><div style="font-size:60px;margin-bottom:10px">üåü</div><div style="font-size:20px;font-weight:bold">Loading Sari's Playhouse...</div></div>
</div>
<script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.2/babel.min.js"></script>
<script>
window.onerror=function(msg,src,line,col,err){
  var d=document.getElementById("loader");
  if(d){d.textContent="";
    var w=document.createElement("div");w.style.cssText="text-align:center;padding:20px;font-family:sans-serif;color:#C050A0";
    var e=document.createElement("div");e.style.fontSize="40px";e.style.marginBottom="10px";e.textContent="\u{1F622}";w.appendChild(e);
    var t=document.createElement("div");t.style.cssText="font-size:16px;font-weight:bold";t.textContent="App Error";w.appendChild(t);
    var m=document.createElement("div");m.style.cssText="font-size:11px;color:#999;margin:8px auto;max-width:300px;word-break:break-all";
    m.textContent=(err&&err.message)||msg||"Unknown error";w.appendChild(m);
    var b=document.createElement("button");b.textContent="Reload";b.onclick=function(){location.reload()};
    b.style.cssText="background:#FF69B4;color:#fff;border:none;border-radius:20px;padding:10px 20px;font-size:14px;margin-top:12px";w.appendChild(b);
    d.appendChild(w)}
  return true;
}
</script>
<script type="text/babel">
const {useState,useEffect,useRef}=React;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SARI'S SOUND QUEST v6
//  PIN Login ¬∑ Question Tracking ¬∑ Story Prizes
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ WORDS ‚îÄ‚îÄ
const WDS=[
{w:"cat",i:"üê±",f:"at"},{w:"bat",i:"ü¶á",f:"at"},{w:"hat",i:"üé©",f:"at"},{w:"mat",i:"üßπ",f:"at"},{w:"sat",i:"üí∫",f:"at"},{w:"rat",i:"üêÄ",f:"at"},{w:"pat",i:"üëã",f:"at"},
{w:"dog",i:"üê∂",f:"og"},{w:"log",i:"ü™µ",f:"og"},{w:"hog",i:"üê∑",f:"og"},{w:"fog",i:"üå´Ô∏è",f:"og"},{w:"jog",i:"üèÉ",f:"og"},
{w:"pig",i:"üê∑",f:"ig"},{w:"big",i:"üèîÔ∏è",f:"ig"},{w:"dig",i:"‚õèÔ∏è",f:"ig"},{w:"wig",i:"üíá",f:"ig"},{w:"fig",i:"üçá",f:"ig"},
{w:"sun",i:"‚òÄÔ∏è",f:"un"},{w:"run",i:"üèÉ",f:"un"},{w:"fun",i:"üéâ",f:"un"},{w:"bun",i:"üçî",f:"un"},
{w:"cup",i:"‚òï",f:"up"},{w:"pup",i:"üê∂",f:"up"},
{w:"bed",i:"üõèÔ∏è",f:"ed"},{w:"red",i:"üî¥",f:"ed"},
{w:"pen",i:"üñäÔ∏è",f:"en"},{w:"hen",i:"üêî",f:"en"},{w:"ten",i:"üîü",f:"en"},
{w:"hot",i:"üî•",f:"ot"},{w:"pot",i:"üç≤",f:"ot"},{w:"dot",i:"‚ö´",f:"ot"},{w:"got",i:"üéÅ",f:"ot"},
{w:"map",i:"üó∫Ô∏è",f:"ap"},{w:"cap",i:"üß¢",f:"ap"},{w:"tap",i:"üö∞",f:"ap"},{w:"nap",i:"üò¥",f:"ap"},
{w:"fin",i:"ü¶à",f:"in"},{w:"pin",i:"üìå",f:"in"},{w:"win",i:"üèÜ",f:"in"},
{w:"sit",i:"ü™ë",f:"it"},{w:"hit",i:"üí•",f:"it"},{w:"bit",i:"üç™",f:"it"},{w:"fit",i:"üí™",f:"it"},
{w:"van",i:"üöê",f:"an"},{w:"can",i:"ü•´",f:"an"},{w:"man",i:"üßë",f:"an"},{w:"fan",i:"üåÄ",f:"an"},{w:"pan",i:"üç≥",f:"an"},{w:"ran",i:"üèÉ",f:"an"},
{w:"bug",i:"üêõ",f:"ug"},{w:"hug",i:"ü§ó",f:"ug"},{w:"mug",i:"‚òï",f:"ug"},{w:"rug",i:"üü´",f:"ug"},{w:"tug",i:"üö¢",f:"ug"},
{w:"hop",i:"üêá",f:"op"},{w:"pop",i:"üéà",f:"op"},{w:"mop",i:"üßπ",f:"op"},{w:"top",i:"üîù",f:"op"},
];
const LS={a:"aah",b:"buh",c:"kuh",d:"duh",e:"eh",f:"fuh",g:"guh",h:"huh",i:"ih",j:"juh",k:"kuh",l:"luh",m:"muh",n:"nuh",o:"aww",p:"puh",r:"ruh",s:"sss",t:"tuh",u:"uh",v:"vuh",w:"wuh",x:"ks",y:"yuh",z:"zzz"};
const AZ="abcdefghijklmnopqrstuvwxyz".split("");

const CHEERS=["Mommy loves you SO much!","Abba is SO proud of you!","Mommy and Abba are cheering!","Mommy says you're amazing!","Abba says that's his girl!","Mommy is jumping up and down!","Abba says wow, Sari, wow!","Bubby Feig is SO proud!","Bubby says that's my granddaughter!","Bubby is shepping nachas!","Bubby Feig is clapping for you!","Kira next door says wow!","Kira is cheering for you!","Kira says you're so smart!","Abby says amazing!","Cousin Ahuvah is cheering!","Cousin Ahuvah says wow Sari!","Baby Talia is clapping for you!","Talia says yay big sister!","Mordechai Shapiro says incredible!","Uncle Moishy is dancing!","Zisha says you're a star!","Daniel Tiger says great job!","Ugga Mugga Sari!","Superstar Sari!","Uncle Aryeh says you're the best!","Rivkah and Asher are cheering!","Cousin Chayala says wow!","Aunt Michal is SO proud!"];
const TRIES=["Almost! Mommy says try again!","So close! Abba believes in you!","Bubby says you're getting it!","Kira says you'll get the next one!","Abby is cheering you on!","Cousin Ahuvah says you can do it!","Baby Talia says try again!","Bubby says winners keep going!","So close Sari!"];
const STIX=["‚≠ê","üåü","üí´","‚ú®","ü¶Ñ","üåà","ü¶ã","üéÄ","üíé","üëë","üå∏","üç≠","üßÅ","üé†","üê¨","ü¶©","üêØ","üçï","üç¶","üå≠","üéµ","üíï","üê±","üê∂","üéà","üç™","üå∫"];

// ‚îÄ‚îÄ FUNNY STORIES (read aloud as prizes!) ‚îÄ‚îÄ
const STORIES=[
{id:"pizza-fish",title:"Sari and the Pizza Fish",emoji:"üçïüêü",text:"Once upon a time, Sari went swimming and found a fish wearing a tiny pizza hat. The fish said, Excuse me, do you know where the pizza shop is? I'm SO hungry! Sari laughed and said, Fish don't eat pizza! The fish looked sad. So Sari brought the fish a pizza, and all the other fish came to watch. Now every Friday, Sari delivers pizza to the fish pond. Bubby says it's the funniest thing she's ever seen. The end!"},
{id:"kira-cloud",title:"Kira's Cloud Ride",emoji:"‚òÅÔ∏è‚ú®",text:"One morning, Sari and Kira looked up and saw a cloud shaped like a giant donut. I bet we could ride that, said Kira. So they climbed up a really tall ladder made of rainbows. The cloud was super soft and fluffy! They rode it all the way to Bais Yaakov. Their teacher said, Girls, why are you wet? Because we rode a cloud, Morah! The whole class wanted cloud rides after that. The end!"},
{id:"talia-words",title:"Baby Talia's First Word",emoji:"üë∂üí¨",text:"Baby Talia was sitting in her high chair when she looked at Sari and said her very first word. Everyone got quiet. Talia opened her mouth and said... PIZZA! Abba laughed so hard milk came out of his nose. Mommy said, Just like your big sister! Bubby called everyone on the phone. My granddaughter said pizza! Then Talia said her second word... MORE PIZZA! The end!"},
{id:"tiger-school",title:"Daniel Tiger Visits Bais Yaakov",emoji:"üêØüè´",text:"Daniel Tiger showed up at Bais Yaakov one day wearing a backpack. Hi! I'm here to learn! he said. But Daniel Tiger, you're a tiger! said the teacher. Daniel sat at Sari's desk and tried to hold a pencil. His paws were too big! He tried to eat lunch but his sandwich was way too small. At recess he was the BEST at tag because nobody could catch a tiger. Ugga mugga, Sari! said Daniel Tiger. Best school day ever! The end!"},
{id:"hat-party",title:"The Silly Hat Party",emoji:"üé©üéâ",text:"Sari found a magic hat in the closet. When she put it on, it turned into a crown! When Abba put it on, it turned into a giant banana! When Mommy put it on, it turned into a birthday cake with candles! Bubby put it on and it turned into a hat made of candy. When baby Talia grabbed it, the hat turned into a tiny hat for a tiny baby and everyone said awwww. Kira came over and the hat turned into TWO hats so they could match. Best hat ever! The end!"},
{id:"swimming-mermaid",title:"Sari the Mermaid",emoji:"üßú‚Äç‚ôÄÔ∏èüèä",text:"Sari was swimming when she noticed her feet felt funny. She looked down and saw a sparkly mermaid tail! Cool! she said, and dove under the water. She could breathe underwater! The fish from the pizza story swam over. Hey Sari! Want to see our house? The fish lived in a tiny city at the bottom of the pool with tiny roads and a tiny pizza shop. Sari ate the world's smallest pizza. When she got out of the pool, her legs came back. But she found a tiny seashell in her pocket that whispered, Come back soon! The end!"},
];

// ‚îÄ‚îÄ PRIZES (one per milestone ‚Äî ~1 per night at ~50-60 stars/quest) ‚îÄ‚îÄ
const PRIZES=[
{id:1,s:50,e:"üçï",n:"Pizza Night!",t:"real"},
{id:2,s:110,e:"üç¶",n:"Ice Cream Trip!",t:"real"},
{id:3,s:170,e:"üìñ",n:"Sari & the Pizza Fish",t:"story",sid:"pizza-fish"},
{id:4,s:230,e:"üêØ",n:"Daniel Tiger Movie Night!",t:"real"},
{id:5,s:290,e:"üìñ",n:"Kira's Cloud Ride",t:"story",sid:"kira-cloud"},
{id:6,s:350,e:"üå≠",n:"Hot Dog Party!",t:"real"},
{id:7,s:410,e:"üìñ",n:"Baby Talia's First Word",t:"story",sid:"talia-words"},
{id:8,s:470,e:"üèä‚Äç‚ôÄÔ∏è",n:"Swimming with Kira!",t:"real"},
{id:9,s:530,e:"üìñ",n:"Daniel Tiger at School",t:"story",sid:"tiger-school"},
{id:10,s:590,e:"üìñ",n:"The Silly Hat Party",t:"story",sid:"hat-party"},
{id:11,s:650,e:"üìñ",n:"Sari the Mermaid",t:"story",sid:"swimming-mermaid"},
{id:12,s:720,e:"üíï",n:"Date with Mommy & Abba!",t:"real"},
];

const STG=[{id:"sound",em:"üîä",nm:"Sound Match",cl:"#FF3B8B"},{id:"rhyme",em:"üéµ",nm:"Rhyme Rocket",cl:"#B44BFF"},{id:"blend",em:"üöÄ",nm:"Blend Blaster",cl:"#00C2FF"},{id:"build",em:"üî®",nm:"Word Builder",cl:"#FF9500"}];

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
const shuf=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=0|Math.random()*(i+1);[b[i],b[j]]=[b[j],b[i]]}return b};
const pick=a=>a[0|Math.random()*a.length];
const td=()=>{const d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")};
const yd=()=>{const d=new Date();d.setDate(d.getDate()-1);return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")};

// ‚ïê‚ïê‚ïê VOICE ‚ïê‚ïê‚ïê
let bv=null;const XI_VOICES={"Rachel":"21m00Tcm4TlvDq8ikWAM","Aria":"9BWtsMINqrJLrRacOk9x","Sarah":"EXAVITQu4vr4xnSDxMaL","Charlotte":"XB0fDUnXU5powFXDhCwa","Lily":"pFZP5JQG7iQjIQuC4Bku"};
const audioCache=new Map();let curAudio=null;
// Strip emojis from text before reading aloud
const stripEmoji=(t)=>t.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{27BF}\u{2B50}-\u{2BFF}\u{FE00}-\u{FE0F}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2702}-\u{27B0}\u{200D}\u{20E3}\u{FE0F}\u{E0020}-\u{E007F}\u{2300}-\u{23FF}\u{2934}-\u{2935}\u{25AA}-\u{25FE}\u{2190}-\u{21FF}\u{2139}\u{3030}\u{303D}]/gu,"").replace(/\s{2,}/g," ").trim();
const fv=()=>{if(!window.speechSynthesis)return;const vs=speechSynthesis.getVoices();if(!vs.length)return;
// Priority: warm female voices across all platforms
const ts=[
// iOS
v=>/Samantha.*Enhanced/.test(v.name),
v=>/Samantha.*Premium/.test(v.name),
v=>v.name==='Samantha'&&v.lang==='en-US',
v=>/\bAva\b/.test(v.name)&&v.lang.startsWith('en'),
v=>/\bZoe\b/.test(v.name),
// Samsung
v=>/\bSamsung\b/.test(v.name)&&/female/i.test(v.name)&&v.lang.startsWith('en'),
v=>/\bSamsung\b/.test(v.name)&&v.lang==='en-US',
// Google / Chrome / Android
v=>v.name==='Google US English',
v=>/Google.*English.*Female/i.test(v.name),
v=>/Google.*US/i.test(v.name),
v=>/\bJenny\b/.test(v.name),
v=>/\bKaren\b/.test(v.name),
v=>/\bAria\b/.test(v.name),
// Generic English female
v=>v.lang==='en-US'&&/female/i.test(v.name),
v=>v.lang==='en-US'&&v.localService,
v=>v.lang==='en-US',
v=>v.lang&&v.lang.startsWith('en')];
for(const t of ts){const f=vs.find(t);if(f){bv=f;console.log("Voice:",f.name);return}}
// Last resort: first English voice or any voice
bv=vs.find(v=>v.lang&&v.lang.startsWith('en'))||vs[0];console.log("Voice fallback:",bv?.name)};
// Chrome Android: voices load async, retry until found
if(window.speechSynthesis){fv();speechSynthesis.onvoiceschanged=fv;
if(!bv)setTimeout(fv,100);if(!bv)setTimeout(fv,500);if(!bv)setTimeout(fv,1000)}
const fbSay=(t,r)=>{if(!window.speechSynthesis)return;const clean=stripEmoji(t);if(!clean)return;speechSynthesis.cancel();
setTimeout(()=>{if(!bv)fv();const u=new SpeechSynthesisUtterance(clean);if(bv)u.voice=bv;u.rate=r||.78;u.pitch=1.05;u.volume=1;u.lang="en-US";
if(speechSynthesis.paused)speechSynthesis.resume();
speechSynthesis.speak(u)},50)};
const say=async t=>{fbSay(t,.78)};
const sayL=async l=>{const p=LS[l]||l;if(!window.speechSynthesis)return;speechSynthesis.cancel();
setTimeout(()=>{if(!bv)fv();const u=new SpeechSynthesisUtterance(p);if(bv)u.voice=bv;u.rate=.5;u.pitch=1.05;u.volume=1;u.lang="en-US";speechSynthesis.speak(u)},50)};
const sayW=async w=>{fbSay(w,.68)};
const sayBlend=(w,cb)=>{const ls=w.split("");let d=0;ls.forEach(l=>{setTimeout(()=>sayL(l),d);d+=950});setTimeout(()=>{sayW(w);if(cb)cb()},d+650)};
const initS=()=>{if(speechSynthesis){const u=new SpeechSynthesisUtterance(' ');u.volume=.01;speechSynthesis.speak(u);setTimeout(fv,200)}};

// ‚ïê‚ïê‚ïê SUPABASE ‚ïê‚ïê‚ïê
const SB_URL="https://bkzmrxklmdnjtiurvixm.supabase.co";const SB_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrem1yeGtsbWRuanRpdXJ2aXhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNzk2NjIsImV4cCI6MjA4Njk1NTY2Mn0.ZkFDmergSFm59hs47h2TyQNSiLw0NYjXpmscZ90vD2o";const SB_P="sari";
let sb=null;if(window.supabase)sb=window.supabase.createClient(SB_URL,SB_KEY);

// ‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê
const SK="sq6";const DF={stars:0,ok:0,played:0,streak:0,stk:[],storiesUnlocked:[],last:null,days:0,timerDate:null,timerSecs:0};
const ld=()=>{try{
const p={...DF,...JSON.parse(localStorage.getItem(SK))};
// Migration v2: clear last date in local AND cloud so quest shows correctly
if(localStorage.getItem("sq6_tz_fix")!=="2"){p.last=null;localStorage.setItem("sq6_tz_fix","2");localStorage.setItem(SK,JSON.stringify(p));
if(sb)sb.from("progress").update({last_date:null}).eq("player_id",SB_P)}
// Reset timer if it's a new day
if(p.timerDate!==td()){p.timerDate=td();p.timerSecs=0}
return p}catch{return{...DF}}};
const sv=p=>{try{localStorage.setItem(SK,JSON.stringify(p))}catch{};
if(sb)sb.from("progress").update({stars:p.stars,correct:p.ok,played:p.played,streak:p.streak,stickers:p.stk||[],stories_unlocked:p.storiesUnlocked||[],last_date:p.last,days_played:p.days,timer_date:p.timerDate||td(),timer_seconds:p.timerSecs||0}).eq("player_id",SB_P).then(r=>{if(r.error)console.warn("sync err",r.error)})};
// Lightweight timer-only save (called every 10s, doesn't save all fields)
const svTimer=(secs)=>{
try{const p=JSON.parse(localStorage.getItem(SK)||"{}");p.timerDate=td();p.timerSecs=secs;localStorage.setItem(SK,JSON.stringify(p))}catch{}
if(sb)sb.from("progress").update({timer_date:td(),timer_seconds:secs}).eq("player_id",SB_P).then(()=>{})
};

const recordSession=(results,details,earned,sticker,practice)=>{
if(!sb)return;
const so=results.slice(0,5).filter(Boolean).length,ro=results.slice(5,10).filter(Boolean).length,bo=results.slice(10,15).filter(Boolean).length,wo=results.slice(15,20).filter(Boolean).length;
sb.from("sessions").insert({player_id:SB_P,session_date:td(),total_correct:results.filter(Boolean).length,total_questions:20,sound_correct:so,rhyme_correct:ro,blend_correct:bo,build_correct:wo,stars_earned:earned,sticker_earned:sticker||null,is_practice:practice||false});
if(details&&details.length){const rows=details.map((d,i)=>({player_id:SB_P,session_date:td(),question_num:i+1,game_mode:d.mode,target_word:d.tw||null,target_letter:d.tl||null,word_family:d.fam||null,correct:d.ok,user_answer:d.ua||null,correct_answer:d.ca||null}));
sb.from("answers").insert(rows)}};

const syncCloud=async set=>{if(!sb)return;try{const{data}=await sb.from("progress").select("*").eq("player_id",SB_P).single();
if(data&&data.stars!==undefined){const l=ld();
// Timer: use cloud value if it's for today, otherwise reset
const cloudTimerDate=data.timer_date||null;
const cloudTimerSecs=(cloudTimerDate===td())?(data.timer_seconds||0):0;
const c={stars:data.stars,ok:data.correct,played:data.played,streak:data.streak,stk:data.stickers||[],storiesUnlocked:data.stories_unlocked||[],last:l.last,days:data.days_played,timerDate:td(),timerSecs:Math.max(l.timerSecs||0,cloudTimerSecs)};
if(c.stars>=l.stars){localStorage.setItem(SK,JSON.stringify(c));set(c)}}}catch{}};

// ‚îÄ‚îÄ GENERATORS ‚îÄ‚îÄ
const gS=()=>{const w=pick(WDS),tl=pick(w.w.split("")),wr=shuf(AZ.filter(l=>l!==tl)).slice(0,3);return{m:"sound",letter:tl,opts:shuf([tl,...wr]),word:w}};
const gR=()=>{const w=pick(WDS),rh=WDS.filter(x=>x.f===w.f&&x.w!==w.w);if(!rh.length)return gR();const c=pick(rh),wr=shuf(WDS.filter(x=>x.f!==w.f)).slice(0,2);return{m:"rhyme",target:w,correct:c,opts:shuf([c,...wr])}};
const gB=()=>{const w=pick(WDS),wr=shuf(WDS.filter(x=>x.w!==w.w&&x.f!==w.f)).slice(0,2);return{m:"blend",target:w,opts:shuf([w,...wr])}};
const gW=()=>{const w=pick(WDS),ls=w.w.split(""),ex=shuf(AZ.filter(l=>!ls.includes(l))).slice(0,3);return{m:"build",target:w,tiles:shuf([...ls,...ex])}};
const buildQ=()=>[gS(),gS(),gS(),gS(),gS(),gR(),gR(),gR(),gR(),gR(),gB(),gB(),gB(),gB(),gB(),gW(),gW(),gW(),gW(),gW()];

// ‚îÄ‚îÄ UI ‚îÄ‚îÄ
const BG="linear-gradient(180deg,#FFD6EC 0%,#FFF0F8 50%,#FFE8F5 100%)";const CD="linear-gradient(145deg,#FFFFFF,#FFF5F8)";
const Glow=()=>React.createElement("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:0,background:"radial-gradient(ellipse at 30% 20%,rgba(255,105,180,.12) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(200,100,255,.08) 0%,transparent 50%)"}},...[0,1,2,3,4,5].map(i=>React.createElement("div",{key:i,style:{position:"absolute",left:(10+i*15)+"%",bottom:"-5%",fontSize:[16,12,20,14,18,10][i],animation:`heartFloat ${8+i*2}s ease-in-out ${i*1.5}s infinite`,opacity:.15}},["üíñ","üíó","‚ú®","üíï","‚≠ê","ü©∑"][i])));
const Conf=({on,mega})=>{if(!on)return null;const n=mega?50:30;return React.createElement("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:999}},Array.from({length:n}).map((_,i)=>React.createElement("div",{key:i,style:{position:"absolute",left:Math.random()*100+"%",top:"-5%",width:6+Math.random()*10,height:6+Math.random()*10,backgroundColor:["#FF3B8B","#FFD700","#22BB66","#B44BFF","#00C2FF"][i%5],borderRadius:Math.random()>.5?"50%":"2px",animation:`confettiFall ${.6+Math.random()*1.4}s ease-out forwards`,animationDelay:Math.random()*.5+"s",opacity:0}})))};
const SPop=({s})=>{if(!s)return null;return React.createElement("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{fontSize:120,animation:"stickerPop .6s ease-out forwards"}},s))};

// ‚ïê‚ïê‚ïê PIN LOGIN (tap numbers ‚Äî no keyboard!) ‚ïê‚ïê‚ïê
const PinLogin=({onLogin})=>{
const[pin,setPin]=useState("");const[err,setErr]=useState("");
useEffect(()=>{setTimeout(()=>say("Hi Sari! Tap your secret numbers to start!"),600)},[]);
const tap=n=>{const np=pin+n;setPin(np);setErr("");
if(np.length===4){const SARI_PIN=localStorage.getItem("sq_sari_pin")||"1234";
if(np===SARI_PIN){say("Welcome Sari!");setTimeout(()=>onLogin(),500)}
else{say("Oops! Try again!");setErr("Try again!");setTimeout(()=>{setPin("");setErr("")},1200)}}};
const del=()=>setPin(pin.slice(0,-1));
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,background:BG}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,textAlign:"center",maxWidth:340,width:"100%"}},
React.createElement("div",{style:{fontSize:60,marginBottom:10,animation:"float 3s ease-in-out infinite"}},"üåü"),
React.createElement("h2",{style:{fontSize:26,fontWeight:700,marginBottom:6}},"Hi Sari!"),
React.createElement("p",{style:{color:"rgba(120,40,80,.5)",fontSize:14,marginBottom:24}},"Tap your secret numbers"),
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:12,marginBottom:28}},
...[0,1,2,3].map(i=>React.createElement("div",{key:i,style:{width:48,height:48,borderRadius:14,background:i<pin.length?"linear-gradient(135deg,#FF3B8B,#FF6B8B)":"rgba(255,255,255,.75)",border:i<pin.length?"2px solid #FF3B8B":"2px solid rgba(220,120,170,.25)",transition:"all .2s"}}))),
err&&React.createElement("div",{style:{color:"#FF6B6B",fontSize:15,marginBottom:12,animation:"shake .4s ease"}},err),
React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,maxWidth:260,margin:"0 auto"}},
...[1,2,3,4,5,6,7,8,9,"",0,"‚¨Ö"].map(n=>
n===""?React.createElement("div",{key:"empty"}):
React.createElement("button",{key:n,onClick:()=>n==="‚¨Ö"?del():tap(String(n)),style:{width:"100%",height:64,borderRadius:18,fontSize:n==="‚¨Ö"?24:28,fontWeight:600,background:n==="‚¨Ö"?"rgba(255,255,255,.6)":CD,border:"1.5px solid rgba(220,120,170,.15)"}},n))),
React.createElement("button",{onClick:()=>{window.location.href="/dashboard"},style:{background:"none",border:"none",color:"rgba(220,120,170,.25)",fontSize:12,marginTop:24,padding:8}},"Parent Dashboard ‚Üí")
))};

// ‚ïê‚ïê‚ïê STORY READER ‚ïê‚ïê‚ïê
const StoryReader=({story,onBack})=>{
const[reading,setReading]=useState(false);
useEffect(()=>{setTimeout(()=>{say("Story time! "+story.title);setReading(true);setTimeout(()=>say(story.text),2000)},400)},[]);
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 16px 40px",background:BG}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,width:"100%",maxWidth:440}},
React.createElement("button",{onClick:()=>{if(speechSynthesis)speechSynthesis.cancel();if(curAudio){curAudio.pause();curAudio=null}onBack()},style:{background:"rgba(255,255,255,.6)",borderRadius:12,padding:"8px 16px",fontSize:15,color:"rgba(120,40,80,.6)",marginBottom:20}},"‚Üê Back"),
React.createElement("div",{style:{textAlign:"center",marginBottom:24}},
React.createElement("div",{style:{fontSize:72,marginBottom:12,animation:"bounceIn .5s ease-out"}},story.emoji),
React.createElement("h2",{style:{fontSize:"clamp(22px,6vw,28px)",fontWeight:700,animation:"slideUp .5s ease-out"}},story.title)),
React.createElement("div",{style:{background:"rgba(255,255,255,.6)",borderRadius:22,padding:"24px 20px",fontSize:17,lineHeight:1.8,color:"rgba(80,30,60,.8)",animation:"slideUp .6s ease-out"}},story.text),
React.createElement("div",{style:{display:"flex",gap:12,justifyContent:"center",marginTop:24}},
React.createElement("button",{onClick:()=>say(story.text),style:{background:"linear-gradient(135deg,#B44BFF,#8B3BCF)",borderRadius:18,padding:"14px 28px",fontSize:16,fontWeight:600}},"üîä Read Again"),
React.createElement("button",{onClick:onBack,style:{background:CD,border:"1.5px solid rgba(220,120,170,.25)",borderRadius:18,padding:"14px 28px",fontSize:16,fontWeight:600}},"üè† Home"))))};

// ‚ïê‚ïê‚ïê GAME COMPONENTS (with detail tracking) ‚ïê‚ïê‚ïê
const SoundG=({q,onA})=>{const[sel,setSel]=useState(null);const[res,setRes]=useState(null);const[msg,setMsg]=useState("");
useEffect(()=>{setSel(null);setRes(null);setMsg("");setTimeout(()=>{say("Which letter makes this sound?");
setTimeout(()=>{sayL(q.letter);
// After sound plays, read the choices
setTimeout(()=>{const optText="Is it "+q.opts.map(l=>l.toUpperCase()).join(", or ")+"?";fbSay(optText,.72)},1200)},2800)},400)},[q]);
const tap=l=>{if(sel)return;setSel(l);const ok=l===q.letter;setRes(ok);const m=ok?pick(CHEERS):("The letter was "+q.letter.toUpperCase()+". "+pick(TRIES));setMsg(m);setTimeout(()=>say(m),250);
setTimeout(()=>onA(ok,{mode:"sound",tw:q.word.w,tl:q.letter,fam:q.word.f,ok,ua:l,ca:q.letter}),ok?1800:2600)};
return React.createElement("div",{style:{textAlign:"center",animation:"slideUp .4s ease-out"}},
React.createElement("div",{style:{fontSize:15,color:"rgba(120,40,80,.55)",marginBottom:10}},"Listen and find the letter!"),
React.createElement("button",{onClick:()=>sayL(q.letter),style:{background:"linear-gradient(135deg,#FF3B8B,#FF6B8B)",borderRadius:50,width:"clamp(100px,24vw,130px)",height:"clamp(100px,24vw,130px)",fontSize:"clamp(44px,11vw,60px)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 28px",animation:"pulse 2s ease-in-out infinite",boxShadow:"0 8px 35px rgba(255,59,139,.35)"}},"üîä"),
React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"clamp(12px,3vw,18px)",maxWidth:320,margin:"0 auto"}},
...q.opts.map((l,i)=>{const isC=l===q.letter,isS=l===sel;let bg=CD,bd="2.5px solid rgba(220,120,170,.25)",an=`popIn .3s ease-out ${i*.09}s both`;
if(res!==null&&isC){bg="linear-gradient(145deg,#22BB66,#1FA055)";bd="2.5px solid #22BB66"}if(isS&&!res){bg="linear-gradient(145deg,#FF6B6B,#FF4444)";bd="2.5px solid #FF6B6B";an="shake .4s ease"}
return React.createElement("button",{key:l+i,onClick:()=>tap(l),style:{width:"100%",height:"clamp(74px,19vw,92px)",borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"clamp(32px,9vw,44px)",fontWeight:700,textTransform:"uppercase",background:bg,border:bd,cursor:sel?"default":"pointer",animation:an}},l.toUpperCase())})),
msg&&React.createElement("div",{style:{marginTop:20,fontSize:16,fontWeight:600,animation:"bounceIn .3s ease-out",color:res?"#22BB66":"#FF6B6B",padding:"0 12px",lineHeight:1.4}},msg))};

const RhymeG=({q,onA})=>{const[sel,setSel]=useState(null);const[res,setRes]=useState(null);const[msg,setMsg]=useState("");
useEffect(()=>{setSel(null);setRes(null);setMsg("");setTimeout(()=>{
const optText=q.opts.map((x,i)=>String.fromCharCode(65+i)+", "+x.w).join(". ");
fbSay("What rhymes with "+q.target.w+"? ... "+optText,.75)},400)},[q]);
const tap=x=>{if(sel)return;setSel(x.w);const ok=x.w===q.correct.w;setRes(ok);const m=ok?(q.target.w+" and "+x.w+" rhyme! "+pick(CHEERS)):(q.target.w+" rhymes with "+q.correct.w+". "+pick(TRIES));setMsg(m);setTimeout(()=>say(m),250);
setTimeout(()=>onA(ok,{mode:"rhyme",tw:q.target.w,fam:q.target.f,ok,ua:x.w,ca:q.correct.w}),ok?2000:2800)};
return React.createElement("div",{style:{textAlign:"center",animation:"slideUp .4s ease-out"}},
React.createElement("div",{style:{fontSize:15,color:"rgba(120,40,80,.55)",marginBottom:12}},"What rhymes with..."),
React.createElement("button",{onClick:()=>sayW(q.target.w),style:{background:"linear-gradient(145deg,#B44BFF22,#B44BFF0A)",border:"2.5px solid #B44BFF44",borderRadius:22,padding:"clamp(14px,3vw,20px) clamp(22px,5vw,36px)",display:"inline-flex",alignItems:"center",gap:12,marginBottom:28}},
React.createElement("span",{style:{fontSize:"clamp(40px,10vw,52px)"}},q.target.i),React.createElement("span",{style:{fontSize:"clamp(26px,7vw,36px)",fontWeight:700,textTransform:"uppercase"}},q.target.w),React.createElement("span",{style:{fontSize:24}},"üîä")),
React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:14,maxWidth:340,margin:"0 auto"}},
...q.opts.map((x,i)=>{const isC=x.w===q.correct.w,isS=x.w===sel;let bg=CD,bd="2.5px solid rgba(220,120,170,.15)",an=`popIn .3s ease-out ${i*.1}s both`;
if(res!==null&&isC){bg="linear-gradient(145deg,#22BB6622,#1FA05511)";bd="2.5px solid #22BB66"}if(isS&&!res){bg="linear-gradient(145deg,#FF6B6B22,#FF444411)";bd="2.5px solid #FF6B6B";an="shake .4s ease"}
return React.createElement("button",{key:x.w,onClick:()=>tap(x),style:{background:bg,border:bd,borderRadius:20,padding:"clamp(14px,3vw,18px) 20px",display:"flex",alignItems:"center",gap:14,cursor:sel?"default":"pointer",animation:an}},
React.createElement("span",{style:{fontSize:"clamp(32px,9vw,42px)"}},x.i),React.createElement("span",{style:{fontSize:"clamp(22px,6vw,28px)",fontWeight:600,textTransform:"uppercase"}},x.w))})),
msg&&React.createElement("div",{style:{marginTop:20,fontSize:16,fontWeight:600,animation:"bounceIn .3s ease-out",color:res?"#22BB66":"#FF6B6B",padding:"0 12px",lineHeight:1.4}},msg))};

const BlendG=({q,onA})=>{const[ph,setPh]=useState("bl");const[sel,setSel]=useState(null);const[res,setRes]=useState(null);const[msg,setMsg]=useState("");
useEffect(()=>{setPh("bl");setSel(null);setRes(null);setMsg("");setTimeout(()=>{say("Watch the letters blend together!");setTimeout(()=>sayBlend(q.target.w,()=>{setPh("pk");
// Read options after blend
setTimeout(()=>{const optText=q.opts.map((x,i)=>String.fromCharCode(65+i)+", "+x.w).join(". ");fbSay("Which word is it? ... "+optText,.72)},800)}),3200)},400)},[q]);
const tap=x=>{if(sel)return;setSel(x.w);const ok=x.w===q.target.w;setRes(ok);const m=ok?("Yes! "+x.w+"! "+pick(CHEERS)):("It was "+q.target.w+". "+pick(TRIES));setMsg(m);setTimeout(()=>say(m),250);
setTimeout(()=>onA(ok,{mode:"blend",tw:q.target.w,fam:q.target.f,ok,ua:x.w,ca:q.target.w}),ok?1800:2600)};
const ls=q.target.w.split("");
return React.createElement("div",{style:{textAlign:"center",animation:"slideUp .4s ease-out"}},
React.createElement("div",{style:{fontSize:15,color:"rgba(120,40,80,.55)",marginBottom:18}},"Watch the letters blend!"),
React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:ph==="bl"?28:6,marginBottom:20,transition:"gap .8s cubic-bezier(.34,1.56,.64,1)",minHeight:90}},
...ls.map((l,i)=>React.createElement("div",{key:i,style:{fontSize:"clamp(44px,13vw,60px)",fontWeight:700,color:"#00C2FF",textTransform:"uppercase",animation:`letterSmash .6s ease-out ${i*.5}s both`,textShadow:"0 0 25px rgba(0,194,255,.5)","--sx":i===0?"-80px":i===ls.length-1?"80px":"0px"}},l)),
ph==="pk"&&React.createElement("div",{style:{fontSize:24,color:"#FFD700",marginLeft:10,animation:"bounceIn .3s ease-out"}},"= ?")),
React.createElement("button",{onClick:()=>sayBlend(q.target.w),style:{background:"none",border:"none",fontSize:15,color:"rgba(120,40,80,.5)",marginBottom:24,padding:"8px 16px"}},"üîä Hear again"),
ph==="pk"&&React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:14,maxWidth:340,margin:"0 auto"}},
...q.opts.map((x,i)=>{const isC=x.w===q.target.w,isS=x.w===sel;let bg=CD,bd="2.5px solid rgba(220,120,170,.15)",an=`popIn .3s ease-out ${i*.1}s both`;
if(res!==null&&isC){bg="linear-gradient(145deg,#22BB6622,#1FA05511)";bd="2.5px solid #22BB66"}if(isS&&!res){bg="linear-gradient(145deg,#FF6B6B22,#FF444411)";bd="2.5px solid #FF6B6B";an="shake .4s ease"}
return React.createElement("button",{key:x.w,onClick:()=>tap(x),style:{background:bg,border:bd,borderRadius:20,padding:"clamp(14px,3vw,18px) 20px",display:"flex",alignItems:"center",gap:14,cursor:sel?"default":"pointer",animation:an}},
React.createElement("span",{style:{fontSize:"clamp(32px,9vw,42px)"}},x.i),React.createElement("span",{style:{fontSize:"clamp(22px,6vw,28px)",fontWeight:600,textTransform:"uppercase"}},x.w))})),
msg&&React.createElement("div",{style:{marginTop:20,fontSize:16,fontWeight:600,animation:"bounceIn .3s ease-out",color:res?"#22BB66":"#FF6B6B",padding:"0 12px",lineHeight:1.4}},msg))};

const BuildG=({q,onA})=>{const[blt,setBlt]=useState([]);const[usd,setUsd]=useState(new Set());const[res,setRes]=useState(null);const[msg,setMsg]=useState("");
useEffect(()=>{setBlt([]);setUsd(new Set());setRes(null);setMsg("");setTimeout(()=>{say("Build the word! Listen!");setTimeout(()=>sayW(q.target.w),2800)},400)},[q]);
const tap=(l,idx)=>{if(res!==null||usd.has(idx))return;const nb=[...blt,l];const nu=new Set(usd);nu.add(idx);setBlt(nb);setUsd(nu);sayL(l);
if(nb.length===q.target.w.length){const built=nb.join("");const ok=built===q.target.w;setRes(ok);const m=ok?("Yes! "+q.target.w+"! "+pick(CHEERS)):("The word was "+q.target.w+". "+pick(TRIES));setMsg(m);setTimeout(()=>say(m),300);
setTimeout(()=>onA(ok,{mode:"build",tw:q.target.w,fam:q.target.f,ok,ua:built,ca:q.target.w}),ok?1800:2800)}};
const undo=()=>{if(!blt.length||res!==null)return;const ll=blt[blt.length-1];const su=[...usd].sort((a,b)=>b-a);const rm=su.find(i=>q.tiles[i]===ll);const nu=new Set(usd);if(rm!==undefined)nu.delete(rm);setBlt(blt.slice(0,-1));setUsd(nu)};
return React.createElement("div",{style:{textAlign:"center",animation:"slideUp .4s ease-out"}},
React.createElement("div",{style:{fontSize:15,color:"rgba(120,40,80,.55)",marginBottom:10}},"Build the word!"),
React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:12,marginBottom:18}},
React.createElement("button",{onClick:()=>sayW(q.target.w),style:{background:"linear-gradient(135deg,#FF9500,#FFB347)",borderRadius:50,width:"clamp(80px,20vw,100px)",height:"clamp(80px,20vw,100px)",fontSize:"clamp(38px,10vw,48px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 6px 24px rgba(255,149,0,.3)"}},"üîä"),
React.createElement("span",{style:{fontSize:"clamp(44px,12vw,56px)"}},q.target.i)),
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"clamp(8px,2vw,12px)",marginBottom:26}},
...Array.from({length:q.target.w.length}).map((_,i)=>React.createElement("div",{key:i,style:{width:"clamp(56px,15vw,70px)",height:"clamp(62px,17vw,78px)",borderRadius:18,background:blt[i]?"linear-gradient(145deg,#FF950028,#FF950010)":"rgba(255,255,255,.6)",border:blt[i]?"2.5px solid #FF9500":"2.5px dashed rgba(220,120,170,.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"clamp(30px,8vw,38px)",fontWeight:700,textTransform:"uppercase",animation:blt[i]?"popIn .2s ease-out":undefined}},blt[i]||""))),
React.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"clamp(8px,2vw,12px)",maxWidth:400,margin:"0 auto",marginBottom:18}},
...q.tiles.map((l,i)=>{const u=usd.has(i);return React.createElement("button",{key:i,onClick:()=>tap(l,i),style:{width:"clamp(56px,15vw,68px)",height:"clamp(56px,15vw,68px)",borderRadius:18,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"clamp(26px,7vw,34px)",fontWeight:700,textTransform:"uppercase",background:u?"rgba(120,40,80,.5)":CD,border:u?"2.5px solid rgba(255,255,255,.6)":"2.5px solid rgba(220,120,170,.2)",color:u?"rgba(220,120,170,.25)":"white",cursor:u||res!==null?"default":"pointer",animation:`popIn .2s ease-out ${i*.05}s both`}},l.toUpperCase())})),
blt.length>0&&res===null&&React.createElement("button",{onClick:undo,style:{background:"rgba(255,255,255,.6)",border:"1px solid rgba(220,120,170,.25)",borderRadius:14,padding:"10px 24px",color:"rgba(120,40,80,.6)",fontSize:15}},"‚¨ÖÔ∏è Undo"),
msg&&React.createElement("div",{style:{marginTop:20,fontSize:16,fontWeight:600,animation:"bounceIn .3s ease-out",color:res?"#22BB66":"#FF6B6B",padding:"0 12px",lineHeight:1.4}},msg))};

// ‚ïê‚ïê‚ïê STAGE INTRO ‚ïê‚ïê‚ïê
const StgIntro=({si,onGo})=>{const s=STG[si];
const intros=[
["First up...","Let's hear those sounds!"],
["You're doing great! Next...","Find the rhyming words!"],
["Halfway there!","Blend those letters!"],
["Last one!","Build the words!"]
];
useEffect(()=>{setTimeout(()=>say(intros[si][0]+" "+s.nm+"! "+intros[si][1]),500)},[si]);
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,background:BG}},
React.createElement(Glow),React.createElement("div",{style:{zIndex:2,textAlign:"center"}},
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:12,marginBottom:32}},
...STG.map((st,i)=>React.createElement("div",{key:st.id,style:{width:52,height:52,borderRadius:16,display:"flex",alignItems:"center",justifyContent:"center",fontSize:26,background:i<si?"linear-gradient(145deg,#22BB6633,#22BB6611)":i===si?`linear-gradient(145deg,${st.cl}44,${st.cl}22)`:"rgba(255,255,255,.65)",border:i===si?`2.5px solid ${st.cl}`:"2px solid rgba(220,120,170,.18)",animation:i===si?"pulse 1.5s ease-in-out infinite":undefined}},i<si?"‚úÖ":st.em))),
React.createElement("div",{style:{fontSize:68,marginBottom:12,animation:"bounceIn .5s ease-out"}},s.em),
React.createElement("h2",{style:{fontSize:"clamp(28px,8vw,38px)",fontWeight:700,marginBottom:8,color:s.cl}},s.nm),
React.createElement("p",{style:{fontSize:16,color:"rgba(120,40,80,.6)",marginBottom:36}},"5 questions!"),
React.createElement("button",{onClick:()=>{say("Let's go!");setTimeout(onGo,500)},style:{background:`linear-gradient(135deg,${s.cl},${s.cl}CC)`,borderRadius:24,padding:"20px 52px",fontSize:"clamp(22px,6vw,28px)",fontWeight:700,boxShadow:`0 8px 30px ${s.cl}44`,animation:"glow 2s ease-in-out infinite"}},"LET'S GO! üöÄ")))};

// ‚ïê‚ïê‚ïê QUEST ‚ïê‚ïê‚ïê
const Quest=({onDone,onBack})=>{const[qs]=useState(buildQ);const[qi,setQi]=useState(0);const[res,setRes]=useState([]);const[det,setDet]=useState([]);const[ph,setPh]=useState("intro");const[cf,setCf]=useState(false);const[stk,setStk]=useState(null);
const si=Math.floor(qi/5);const sq=qi%5;const st=STG[si]||STG[3];
const onA=(ok,detail)=>{const nr=[...res,ok];setRes(nr);const nd=[...det,detail];setDet(nd);
if(ok){setCf(true);if(Math.random()>.5){setStk(pick(STIX));setTimeout(()=>setStk(null),1200)}setTimeout(()=>setCf(false),1600)}
setTimeout(()=>{const nq=qi+1;if(nq>=20)onDone(nr,nd);else if(nq%5===0){setQi(nq);setPh("intro")}else setQi(nq)},ok?2000:3000)};
if(ph==="intro")return React.createElement(StgIntro,{si,onGo:()=>setPh("play")});
const q=qs[qi];
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 16px 40px",background:BG}},
React.createElement(Glow),React.createElement(Conf,{on:cf}),React.createElement(SPop,{s:stk}),
React.createElement("div",{style:{zIndex:2,width:"100%",maxWidth:440}},
React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16}},
React.createElement("button",{onClick:()=>{say("Going back!");setTimeout(onBack,400)},style:{background:"rgba(255,255,255,.6)",borderRadius:12,padding:"8px 14px",fontSize:14,color:"rgba(120,40,80,.6)"}},"‚Üê"),
React.createElement("button",{onClick:()=>say(st.nm),style:{display:"flex",alignItems:"center",gap:6,background:"none",padding:4}},React.createElement("span",{style:{fontSize:18}},st.em),React.createElement("span",{style:{fontSize:13,color:st.cl,fontWeight:600}},st.nm)),
React.createElement("div",{style:{fontSize:12,color:"rgba(120,40,80,.4)"}},(qi+1)+"/20")),
React.createElement("div",{style:{display:"flex",gap:4,marginBottom:8}},...STG.map((s,i)=>React.createElement("div",{key:s.id,style:{flex:1,height:6,borderRadius:3,overflow:"hidden",background:"rgba(220,120,170,.18)"}},
React.createElement("div",{style:{height:"100%",borderRadius:3,background:s.cl,width:(i<si?100:i===si?(sq/5*100):0)+"%",transition:"width .5s ease"}})))),
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:10,marginBottom:28}},...Array.from({length:5}).map((_,i)=>{const gi=si*5+i;
return React.createElement("div",{key:i,style:{width:16,height:16,borderRadius:9,background:gi<res.length?(res[gi]?"#22BB66":"#FF6B6B"):gi===qi?st.cl:"rgba(220,120,170,.25)",transition:"all .3s",boxShadow:gi===qi?`0 0 12px ${st.cl}55`:"none"}})})),
q.m==="sound"&&React.createElement(SoundG,{q,onA}),q.m==="rhyme"&&React.createElement(RhymeG,{q,onA}),q.m==="blend"&&React.createElement(BlendG,{q,onA}),q.m==="build"&&React.createElement(BuildG,{q,onA})))};

// ‚ïê‚ïê‚ïê QUEST DONE ‚ïê‚ïê‚ïê
const QDone=({res,earned,ns,prize,streak,onHome})=>{const ok=res.filter(Boolean).length;const pct=Math.round(ok/20*100);const[cf,setCf]=useState(false);
useEffect(()=>{setCf(true);setTimeout(()=>setCf(false),5000);
const fam=pct>=80?pick(["Mommy and Abba are SO proud!","Bubby can't believe it!","Kira is amazed!"]):pct>=60?pick(["Abba says wow!","Mommy is happy!","Bubby is clapping!"]):pick(["Mommy says keep going!","Abba believes in you!"]);
setTimeout(()=>say((pct===100?"Perfect! ":"Great job Sari! ")+fam+" You earned "+earned+" stars!"+(streak>1?" "+streak+" days in a row!":"")),700)},[]);
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,background:BG}},
React.createElement(Glow),React.createElement(Conf,{on:cf,mega:pct>=80}),
React.createElement("div",{style:{zIndex:2,textAlign:"center",maxWidth:420,width:"100%"}},
React.createElement("div",{style:{fontSize:"clamp(70px,20vw,100px)",marginBottom:10,animation:"bounceIn .5s ease-out"}},pct===100?"üëë":pct>=80?"üèÜ":"‚≠ê"),
React.createElement("h2",{style:{fontSize:"clamp(26px,7vw,34px)",fontWeight:700,marginBottom:4}},pct===100?"PERFECT!":pct>=80?"AMAZING!":"GREAT JOB!"),
React.createElement("div",{style:{fontSize:17,color:"rgba(120,40,80,.55)",marginBottom:8}},ok," out of 20 correct"),
streak>0&&React.createElement("div",{style:{fontSize:16,color:"#FFD700",marginBottom:16}},"üî• ",streak," day streak!"),
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:8,marginBottom:20}},...STG.map((s,i)=>{const sr=res.slice(i*5,i*5+5).filter(Boolean).length;
return React.createElement("div",{key:s.id,style:{background:"rgba(255,255,255,.65)",borderRadius:16,padding:"10px 14px",textAlign:"center",border:`1px solid ${s.cl}33`}},
React.createElement("div",{style:{fontSize:24}},s.em),React.createElement("div",{style:{fontSize:13,fontWeight:600,color:s.cl}},sr+"/5"))})),
React.createElement("div",{style:{background:"linear-gradient(145deg,rgba(255,215,0,.12),rgba(255,215,0,.04))",border:"1.5px solid rgba(255,215,0,.25)",borderRadius:20,padding:"14px 28px",display:"inline-flex",alignItems:"center",gap:10,marginBottom:20}},
React.createElement("span",{style:{fontSize:36,animation:"starPulse 1.5s ease-in-out infinite"}},"‚≠ê"),React.createElement("span",{style:{fontSize:28,fontWeight:700,color:"#FFD700"}},"+",earned)),
ns&&React.createElement("div",{style:{display:"inline-flex",alignItems:"center",gap:10,background:"rgba(180,75,255,.12)",border:"1.5px solid rgba(180,75,255,.3)",borderRadius:20,padding:"12px 24px",marginBottom:16}},React.createElement("span",{style:{fontSize:40}},ns),React.createElement("span",{style:{fontSize:15,fontWeight:600}},"New sticker!")),
prize&&React.createElement("div",{style:{background:"linear-gradient(145deg,rgba(255,59,139,.18),rgba(180,75,255,.08))",border:"2px solid #FF3B8B",borderRadius:22,padding:"20px 24px",marginBottom:20}},
React.createElement("div",{style:{fontSize:13,color:"#FF3B8B",fontWeight:600,letterSpacing:1}},"üéâ NEW PRIZE! üéâ"),
React.createElement("div",{style:{fontSize:48,margin:"8px 0"}},prize.e),React.createElement("div",{style:{fontSize:19,fontWeight:700}},prize.n),
prize.t==="real"&&React.createElement("div",{style:{fontSize:12,color:"rgba(120,40,80,.5)",marginTop:4}},"Show Abba to redeem! üéüÔ∏è"),
prize.t==="story"&&React.createElement("div",{style:{fontSize:12,color:"#B44BFF",marginTop:4}},"üìñ A new story to listen to!")),
React.createElement("button",{onClick:()=>{say("See you tomorrow!");setTimeout(onHome,600)},style:{background:"linear-gradient(135deg,#FF3B8B,#FF6B8B)",borderRadius:22,padding:"18px 44px",fontSize:"clamp(18px,5vw,22px)",fontWeight:700,boxShadow:"0 6px 25px rgba(255,59,139,.3)"}},"üè† Done!")))};

// ‚ïê‚ïê‚ïê PRIZES ‚ïê‚ïê‚ïê
const PrizePg=({prog,onBack,onStory})=>{
useEffect(()=>{const ul=PRIZES.filter(p=>p.s<=prog.stars);setTimeout(()=>say(ul.length?"You have "+ul.length+" prizes!":"Play to earn prizes!"),500)},[]);
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 16px 40px",background:BG}},
React.createElement(Glow),React.createElement("div",{style:{zIndex:2,width:"100%",maxWidth:440}},
React.createElement("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:20}},
React.createElement("button",{onClick:onBack,style:{background:"rgba(255,255,255,.6)",borderRadius:12,padding:"8px 16px",fontSize:15,color:"rgba(120,40,80,.6)"}},"‚Üê Back"),
React.createElement("h2",{style:{fontSize:22,fontWeight:700}},"üéÅ Prizes")),
prog.stk&&prog.stk.length>0&&React.createElement("div",{style:{background:"rgba(255,255,255,.6)",borderRadius:18,padding:"14px 16px",marginBottom:18}},
React.createElement("div",{style:{fontSize:13,color:"rgba(120,40,80,.5)",marginBottom:8}},"üèÜ Stickers ("+prog.stk.length+")"),
React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6}},...prog.stk.map((s,i)=>React.createElement("span",{key:i,style:{fontSize:24}},s)))),
React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:12}},...PRIZES.map((p,i)=>{const ok=prog.stars>=p.s;
return React.createElement("button",{key:p.id,onClick:()=>{if(ok&&p.t==="story"){const st=STORIES.find(s=>s.id===p.sid);if(st)onStory(st)}else say(ok?(p.n+(p.t==="real"?" Show Abba!":"")):(p.n+" Need "+p.s+" stars"))},
style:{background:ok?"linear-gradient(145deg,rgba(255,215,0,.1),rgba(255,59,139,.06))":"rgba(255,255,255,.025)",border:ok?"1.5px solid rgba(255,215,0,.25)":"1px solid rgba(255,255,255,.75)",borderRadius:20,padding:"14px 18px",display:"flex",alignItems:"center",gap:12,opacity:ok?1:.4,animation:`slideUp .3s ease-out ${i*.05}s both`,width:"100%",textAlign:"left"}},
React.createElement("div",{style:{fontSize:"clamp(30px,8vw,42px)"}},ok?p.e:"üîí"),
React.createElement("div",{style:{flex:1}},React.createElement("div",{style:{fontSize:15,fontWeight:600}},p.n),
React.createElement("div",{style:{fontSize:11,color:"rgba(120,40,80,.45)"}},ok?(p.t==="real"?"Show Abba! üéüÔ∏è":p.t==="story"?"üìñ Tap to listen!":"Collected!"):p.s+" stars")),
ok&&p.t==="story"&&React.createElement("div",{style:{fontSize:18}},"‚ñ∂Ô∏è"))}))))};

// ‚ïê‚ïê‚ïê MORAH AI TUTOR ‚ïê‚ïê‚ïê
const MORAH_BASE=`You are Morah, a warm, patient, fun tutor for Sari, a 6-year-old frum girl.

ABOUT SARI:
- Goes to Bais Yaakov Pomona
- Family: Mommy (Minky), Abba (Eli/Daddy), baby sister Talia, Bubby Feig
- Abba's partner Jack at work, Jack's kids are Rivkah and Asher (Sari likes them)
- Cousin Ahuvah (her mommy is Nechama, her daddy is Guido)
- Cousin Chayala (Abba's brother's daughter)
- Cousin Chaya Fireman (Aunt Michal's daughter ‚Äî Michal is Abba's sister)
- Uncle Aryeh (Abba's younger brother, Sari loves him)
- Friends: Kira (next door), Abby
- Loves: Mordechai Shapiro, Daniel Tiger, swimming, pizza, ice cream, Llama Llama, Pete the Cat
- Loves Slurpees from 7-Eleven!
- Loves hugging her special blanket
- Has a playhouse under the basement stairs in the new house ‚Äî she tells EVERYONE about it and loves playing there
- Note: "Abba" means Daddy (Eli). Use "Abba" not "Daddy" when referring to her father.

RULES:
- RESPOND WITH ONLY A RAW JSON OBJECT. No backticks. No markdown. No \`\`\`json. No explanation. No preamble. Just { ... } and nothing else. This is critical.
- Keep "say" to 1-2 short sentences max (except Book Time which can be longer). She's 6!
- Be VERY encouraging, even when wrong
- When she gets it wrong, gently give the answer and move on
- Reference her people: "Mommy is SO proud!" "Bubby is clapping!" "Kira says wow!"
- Use fun emojis
- VARIETY IS KEY: Never repeat the same question type, word, or number twice in a row. Each turn should feel fresh and different. Use different emoji objects, different words, different scenarios each time.
- The [seed:XX] number in Sari's first message is a randomizer ‚Äî use it to pick a DIFFERENT starting point each session. If seed is even, start from the middle/end of your scenario options. If odd, start from ones you'd normally skip.
- SESSION FORMAT: Each session is 8 questions. Start easy/fun to build confidence, get a little harder in the middle, end with something she can nail. Keep energy HIGH throughout ‚Äî she should feel like a superstar!

RESPONSE FORMAT (strict JSON only):
{
  "say": "What Morah says (spoken aloud)",
  "emoji": "üê±",
  "options": [
    {"label": "CAT", "correct": true},
    {"label": "DOG", "correct": false},
    {"label": "BIG", "correct": false}
  ]
}

If no options needed (celebrating, narrating), omit "options":
{"say": "Amazing job Sari!", "emoji": "üéâ"}

OPTIONS: 2-4 big buttons. One must have "correct": true.`;

const MORAH_MODES={
sound:{
name:"Read Words",emoji:"üìñ",color:"#FF3B8B",
prompt:`MODE: READ WORDS (blending & word reading)
Sari knows her letter sounds. MAINLY focus on blending and reading, but mix in basic letter sounds ~20% of the time to keep them sharp.

VARIETY: NEVER do the same activity type twice in a row. Pick RANDOMLY from:

MAIN ACTIVITIES (80% of the time):
1. BLEND IT: Sound out slowly "cuh-aah-tuh" and ask "What word is that?" (give 3 word choices: CAT, CUT, COT)
2. WHICH WORD: Show emoji üê∂ and ask "Which word matches?" (give 3 choices: DOG, DIG, DAD)
3. VOWEL SWAP: "CAT has A in the middle. Change it to U ‚Äî what word?" (give choices: CUT, COP, CUP)
4. MISSING LETTER: "The word is _OG üê∂. What's missing?" (give choices: D, B, L)
5. ENDING SOUND: "What sound does BED end with?" (give choices: D, B, T)
6. WORD BUILDING: "Put these sounds together: mmm-aaa-ppp. What word?" (give choices: MAP, MOP, MAD)
7. READ & PICK: "Which of these is a real word?" (give choices: CAT, ZOG, FIB ‚Äî mix real and nonsense)

BASIC REVIEW (20% of the time ‚Äî keep it quick):
8. LETTER SOUND: Show a letter and ask what sound it makes (give 3 sound choices)
9. BEGINNING SOUND: "What sound does FISH start with?" (give letter choices: F, S, H)

DIFFICULTY:
- Mix 3-letter CVC words with occasional 4-letter words (stop, flag, swim)
- Distinguish similar words (cat/cut/cot, big/bag/bug, pin/pan/pen)
- Focus on her WEAK WORDS if listed
- Use different words each turn ‚Äî don't repeat!

Labels should be UPPERCASE words or single letters.`},

rhyme:{
name:"Rhyme Time",emoji:"üéµ",color:"#B44BFF",
prompt:`MODE: RHYME TIME
1. Say a word with its emoji: "Let's find words that rhyme with CAT! üê±"
2. Give 3-4 word choices, one rhymes
3. When she picks right: celebrate and explain WHY it rhymes ("HAT and CAT both end in -AT!")
4. Then try another rhyme family
5. Mix in silly made-up rhymes for fun: "Does SARI rhyme with SAFARI? Hehe!"
Labels should be UPPERCASE words like "HAT", "DOG", "BIG".`},

book:{
name:"Book Time",emoji:"üìö",color:"#FF9500",
prompt:`MODE: BOOK TIME (interactive story)
Tell an ORIGINAL story inspired by popular kids' books Sari loves (Daniel Tiger, Llama Llama, Pete the Cat, Elephant & Piggie, Frog and Toad style). DO NOT copy any real book ‚Äî create a fresh story each time.

CRITICAL PACING RULE: Each message should be a FULL PARAGRAPH ‚Äî 3 to 5 sentences minimum! Do NOT stop after one sentence. Tell a real chunk of story each turn. Think of it like reading a page of a picture book.

STRUCTURE:
1. First message: A fun title, then a FULL opening paragraph (4-5 sentences setting up the story and characters). Use a big emoji scene. Give one button: "Keep going!" (correct:true)
2. Next 2-3 messages: Continue the story with FULL PARAGRAPHS (3-5 sentences each). Just give a "Keep going!" or "What happens next?" button (correct:true). Let the story breathe!
3. After 2-3 paragraphs of pure story, THEN pause for interaction:
   - Make a story choice: "Should Llama go to the PARK or the PIZZA SHOP?" (both correct:true ‚Äî she picks the plot!)
   - Or a fun question: "How do you think Pete feels? HAPPY or SAD?"
   - Or sound out a word: "The cat found a H-A-T! What word is it?" (give word choices)
4. Then 2-3 more paragraphs of story before the next interaction
5. Story should be about 6-8 total messages with only 2-3 interactive pauses
6. End with a warm paragraph that references Sari and her family
7. Final message: full concluding paragraph + "The end! üìñ" with no options

IMPORTANT: 
- Story choices where both answers are valid: set ALL options to correct:true
- MOST messages should be story paragraphs with just a "Keep going!" button
- Only 2-3 of the messages should have real choices/questions
- Each "say" should be 3-5 sentences, NOT just one line

Story ideas (pick one randomly, make it original each time):
- Daniel Tiger visits Sari's school and something funny happens
- Pete the Cat finds a magic object and needs Sari's help
- Baby Talia's first day doing something silly
- Kira and Sari discover something amazing in the backyard
- Llama Llama has a sleepover at Sari's house
- A frog and a bird become best friends
- A bunny goes on an adventure to find the best challah
- A puppy gets lost and Sari helps it find its way home
- Sari's playhouse under the stairs becomes a magical kingdom
- Uncle Aryeh takes Sari on a silly adventure to 7-Eleven for Slurpees
- Sari's blankie goes on an adventure while she's at school
- Rivkah and Asher visit and they discover something in the playhouse
- Cousin Chayala and Sari have a pretend restaurant

Make the language simple (6-year-old level), warm, and funny. Use emojis throughout the text.`},

numbers:{
name:"Numbers",emoji:"üî¢",color:"#22BB66",
prompt:`MODE: NUMBERS (counting & simple math)

CRITICAL DISPLAY RULE: The "emoji" field is shown BIG on screen. For counting questions, put ALL the emojis to count in the "emoji" field. Example: if asking "how many stars?", set emoji to "‚≠ê‚≠ê‚≠ê‚≠ê" (4 stars). The child counts what she SEES.

VARIETY: NEVER do the same activity type twice in a row. Mix it up every turn. Pick RANDOMLY from:

1. COUNTING: Put multiple emojis in "emoji" field. Say "How many do you see?" 
   emoji: "üçïüçïüçï" ‚Üí choices: "3", "5", "1"
   emoji: "üåüüåüüåüüåüüåü" ‚Üí choices: "5", "3", "7"
   
2. STORY ADDITION: "Abba bought 2 challahs üçûüçû, then Mommy baked 1 more! How many now?"
   emoji: "üçûüçû‚ûïüçû" ‚Üí choices: "3", "4", "2"
   
3. STORY SUBTRACTION: "Sari had 5 cookies üç™ and gave 2 to Kira. How many left?"
   emoji: "üç™üç™üç™üç™üç™" ‚Üí choices: "3", "5", "1"

4. WHICH IS MORE/LESS: "Which group has MORE?"
   emoji: "üê±üê±üê± or üê∂üê∂üê∂üê∂üê∂" ‚Üí choices: "CATS", "DOGS"

5. WHAT COMES NEXT: "2, 4, 6, ___?" ‚Üí choices: "8", "7", "10"

6. SKIP COUNTING: "Count by 2s! 2, 4, ___?" ‚Üí choices: "6", "5", "7"

Use different objects each time (pizza, stars, cookies, fish, hearts, challahs, apples, balloons).
Reference her family: "Bubby brought 3 presents!", "Talia has 2 toys!"
Keep numbers 1-10 for counting, up to 15 for addition.
Labels should be numbers like "3", "5", "8" or short words like "MORE", "LESS".`},

alefbeis:{
name:"Alef-Beis",emoji:"‚ú°Ô∏è",color:"#E8D44D",
prompt:`MODE: ALEF-BEIS (Hebrew reading with nekudos)
Sari knows her Hebrew letters. MAINLY focus on nekudos and reading, but mix in letter review ~20% of the time.

VARIETY: NEVER do the same activity type twice in a row. Pick RANDOMLY from:

MAIN ACTIVITIES (80% of the time):
1. NEKUDOS PRACTICE: Show letter + nekuda: "What sound does ◊ë÷∏ make?" (choices: "BA", "BI", "BU")
2. READ THE WORD: "Can you read this? ◊©÷∏◊Å◊ú◊ï÷π◊ù" (choices: "SHALOM", "SHABBOS", "SIMCHA")
3. MATCH NEKUDA: "Which nekuda makes the AH sound?" (choices with nekuda names: "KAMATZ", "CHIRIK", "CHOLAM")
4. BUILD A WORD: "◊©◊Å + ÷∏ + ◊ë + ÷∏ + ◊™ = ?" (choices: "SHABBOS", "SHALOM", "SEFER")
5. NEKUDA SWAP: "◊ë÷∏ says BA. Change kamatz to chirik ‚Äî what sound?" (choices: "BI", "BU", "BA")

BASIC REVIEW (20% of the time):
6. LETTER SPOT: "Which letter is Shin?" (choices: "◊©◊Å", "◊°", "◊¶")
7. LETTER SOUND: "What sound does ◊ë make?" (choices: "BUH", "GUH", "DUH")

NEKUDOS REFERENCE:
Kamatz ÷∏ = AH, Patach ÷∑ = AH, Chirik ÷¥ = EE, Cholam ◊ï÷π = OH, Shuruk ◊ï÷º = OO, Segol ÷∂ = EH, Tzeirei ÷µ = AY, Kubutz ÷ª = OO, Shva ÷∞ = quick

FAMILIAR WORDS:
◊©÷∏◊Å◊ú◊ï÷π◊ù (Shalom), ◊©÷∑◊Å◊ë÷∏÷º◊™ (Shabbos), ◊ó÷∑◊ú÷∏÷º◊î (Challah), ◊™÷º◊ï÷π◊®÷∏◊î (Torah), ◊ê÷∑◊ë÷∏÷º◊ê (Abba), ◊ê÷¥◊û÷∏÷º◊ê (Ima), ◊ë÷∑÷º◊ô÷¥◊™ (Bayis), ◊°÷µ◊§÷∂◊® (Sefer), ◊ë÷∞÷º◊®÷∏◊õ÷∏◊î (Bracha), ◊û÷¥◊¶÷∞◊ï÷∏◊î (Mitzvah), ◊°÷¥◊ì÷º◊ï÷º◊® (Siddur)

Use DIFFERENT letters and words each turn ‚Äî don't repeat!
Put the Hebrew character(s) being practiced in the "emoji" field so it shows BIG.
Labels: transliterated sounds like "BA", "SHALOM" or Hebrew letters.
Reference: "Just like in Bais Yaakov!" "Morah in school would be so proud!"`},

middos:{
name:"Middos",emoji:"üíõ",color:"#FFB347",
prompt:`MODE: MIDDOS (character traits & manners)
Present short scenarios and ask Sari what the right thing to do is.

CRITICAL: NEVER repeat a scenario topic. Each turn MUST be a completely different situation with different people and a different middah. Pick RANDOMLY from the list below.

SCENARIO BANK (use a DIFFERENT one each turn):
CHESED (kindness):
- "A new girl at school is sitting alone at lunch. What do you do?" ‚Üí "SIT WITH HER" / "IGNORE HER"
- "You see Mommy looks tired after a long day. What do you do?" ‚Üí "GIVE A HUG" / "ASK FOR SNACK"
- "An old man at shul dropped his siddur. What do you do?" ‚Üí "PICK IT UP" / "KEEP WALKING"
- "Your friend Abby fell down at recess and scraped her knee." ‚Üí "HELP HER UP" / "KEEP PLAYING"

SAVLANUS (patience):
- "Abba is helping Talia first and you have to wait." ‚Üí "WAIT MY TURN" / "WHINE"
- "The pizza is too hot to eat right now!" ‚Üí "WAIT TO COOL" / "EAT IT NOW"
- "You're waiting in a long line for the slide at the park." ‚Üí "WAIT NICELY" / "PUSH AHEAD"
- "Mommy said dinner will be ready in 10 minutes." ‚Üí "PLAY QUIETLY" / "KEEP ASKING"

HAKORAS HATOV (gratitude):
- "Bubby Feig brought you a surprise present!" ‚Üí "THANK YOU!" / "I WANT MORE"
- "Morah at school helped you with your project." ‚Üí "SAY THANK YOU" / "WALK AWAY"
- "Abba made you your favorite breakfast!" ‚Üí "THANK YOU ABBA" / "I WANT DIFFERENT"
- "Your friend Kira let you borrow her favorite toy." ‚Üí "SAY THANKS" / "KEEP IT"

EMES (honesty):
- "You accidentally spilled juice on the carpet." ‚Üí "TELL MOMMY" / "HIDE IT"
- "You ate the last cookie that was for Talia." ‚Üí "TELL THE TRUTH" / "SAY I DIDN'T"
- "You didn't brush your teeth but Mommy asks if you did." ‚Üí "BE HONEST" / "SAY YES"
- "You broke a crayon at school." ‚Üí "TELL MORAH" / "BLAME SOMEONE"

KAVOD (respect):
- "Bubby is telling a story from when she was little." ‚Üí "LISTEN" / "PLAY ON PHONE"
- "Morah at school is talking and you want to say something." ‚Üí "RAISE HAND" / "SHOUT OUT"
- "Mommy asks you to clean up your toys." ‚Üí "CLEAN UP" / "SAY NO"
- "An older person walks into the room and there's one chair." ‚Üí "OFFER SEAT" / "STAY SITTING"

NEDIVUS (generosity):
- "You have 4 cookies and Kira has none." ‚Üí "SHARE SOME" / "EAT THEM ALL"
- "Abby forgot her lunch at school today." ‚Üí "SHARE MINE" / "TOO BAD"
- "You got two prizes and Talia got none." ‚Üí "GIVE ONE" / "KEEP BOTH"
- "A tzedakah box is being passed around at school." ‚Üí "PUT IN COINS" / "PASS IT"

SIMCHA (joy/celebrating others):
- "Kira won a prize at school and you didn't." ‚Üí "SAY MAZEL TOV" / "BE JEALOUS"
- "Abby got a new bike for her birthday!" ‚Üí "BE HAPPY FOR HER" / "SAY NOT FAIR"
- "Talia just took her first steps!" ‚Üí "CLAP AND CHEER" / "IGNORE IT"

ACHRAYUS (responsibility):
- "You promised to feed the fish today." ‚Üí "FEED THEM" / "FORGET IT"
- "It's your turn to set the table for Shabbos." ‚Üí "SET THE TABLE" / "PRETEND I FORGOT"
- "You have homework but want to play outside." ‚Üí "DO HOMEWORK" / "PLAY FIRST"

STRUCTURE:
1. Describe a short scenario with emojis (1-2 sentences)
2. Give 2 choices ‚Äî one is the good middah, one is not
3. If she picks right: celebrate and name the middah! "That's chesed! Hashem loves when we're kind!"
4. If she picks wrong: gently redirect "Hmm, what if WE were sad and alone? The middah of chesed means being kind to everyone!"
5. IMMEDIATELY move to a completely DIFFERENT scenario type and DIFFERENT people

Use her real people (Kira, Talia, Abby, Mommy Minky, Abba Eli, Bubby Feig, Morah at school, cousin Ahuvah, cousin Chayala, cousin Chaya Fireman, Uncle Aryeh, Rivkah, Asher).
Labels should be short actions: "SHARE", "WAIT", "HELP", "THANK YOU", "TELL TRUTH", "LISTEN".`},

friends:{
name:"Friends",emoji:"ü§ù",color:"#FF6B9D",
prompt:`MODE: BEIN ADAM L'CHAVERO (relationships ‚Äî being a good friend, sister, daughter)
You are teaching Sari how to build and maintain beautiful relationships with the people in her life. This is DIFFERENT from Middos ‚Äî Middos teaches general character traits, this mode teaches the SKILL of relating to specific people in her life.

CRITICAL: Each scenario should feel REAL and specific to Sari's daily life. Use her actual family and friends. Make Sari think about how the OTHER person feels.

CATEGORIES (pick randomly, never repeat the same category twice in a row):

BEING A BIG SISTER (Talia):
- "Baby Talia is crying and reaching for YOUR toy. She looks at you with big eyes." ‚Üí "LET HER HOLD IT" / "SAY NO MINE"
- "Talia just learned to say your name! She keeps saying 'Sari! Sari!' while you're playing." ‚Üí "PLAY WITH HER" / "TELL HER STOP"
- "Mommy asks you to sing to Talia while she makes dinner. Talia loves your voice!" ‚Üí "SING TO HER" / "SAY I'M BUSY"
- "Talia knocked over your block tower by accident. She didn't mean to." ‚Üí "IT'S OKAY" / "GET MAD"
- "Talia is trying to walk and keeps falling. She looks scared." ‚Üí "HOLD HER HAND" / "LAUGH"

BEING A GOOD FRIEND (Kira, Abby, school friends):
- "Kira wants to play house but you want to play school." ‚Üí "TAKE TURNS" / "ONLY MY WAY"
- "A new girl joined your class and she doesn't know anyone yet." ‚Üí "INVITE HER OVER" / "STAY WITH MY FRIENDS"
- "Abby told you a secret and asked you not to share it." ‚Üí "KEEP THE SECRET" / "TELL EVERYONE"
- "You and Kira both want to be the Morah in pretend play." ‚Üí "SHE GOES FIRST" / "I ALWAYS GO FIRST"
- "Your friend got a better grade than you on a test." ‚Üí "SAY GREAT JOB" / "FEEL BAD"
- "Kira accidentally broke your crayon. She feels terrible about it." ‚Üí "IT'S JUST A CRAYON" / "DON'T TALK TO HER"

KIBUD AV V'EM (honoring parents):
- "Mommy had a really long day and looks tired when she comes home." ‚Üí "GIVE HER A HUG" / "ASK FOR A TREAT"
- "Abba asks you to come to the table for dinner but you're in the middle of playing." ‚Üí "COME RIGHT AWAY" / "SAY 5 MORE MINUTES"
- "Mommy and Abba are talking to each other about something important." ‚Üí "WAIT QUIETLY" / "INTERRUPT THEM"
- "Abba made you a lunch but it's not exactly what you wanted." ‚Üí "SAY THANK YOU" / "SAY I DON'T WANT THIS"

DAN L'KAF ZCHUS (judging favorably):
- "Kira walked right past you without saying hi at school today." ‚Üí "MAYBE SHE DIDN'T SEE ME" / "SHE'S BEING MEAN"
- "Your friend didn't invite you to her birthday party." ‚Üí "MAYBE SMALL PARTY" / "SHE DOESN'T LIKE ME"
- "Morah didn't call on you even though your hand was up first." ‚Üí "SHE'LL CALL ME NEXT TIME" / "IT'S NOT FAIR"

MAKING UP & FORGIVENESS:
- "You said something that hurt Kira's feelings and she looks sad." ‚Üí "SAY I'M SORRY" / "PRETEND I DIDN'T"
- "Abby said sorry for bumping into you. She looks worried." ‚Üí "I FORGIVE YOU" / "STAY MAD"
- "You and your friend had a fight yesterday. Today is a new day." ‚Üí "SAY LET'S BE FRIENDS" / "IGNORE HER"

HOSTING & BEING A GUEST:
- "Cousin Ahuvah is coming over and she's never been to your house before." ‚Üí "SHOW HER AROUND" / "PLAY BY MYSELF"
- "You're at Chayala's house and she offers you a snack you don't love." ‚Üí "SAY THANK YOU" / "SAY I DON'T LIKE THAT"

STRUCTURE:
1. Describe a REAL, relatable scenario with emojis (2-3 sentences max, paint a vivid picture)
2. Ask "What should Sari do?" or "How should Sari handle this?"
3. Give 2 choices ‚Äî one builds the relationship, one hurts it
4. If she picks right: celebrate and explain WHY it helps the relationship! "When we let our little sister hold our toy, it makes her feel SO loved! Talia thinks you're the best big sister ever!"
5. If she picks wrong: gently explain how the other person would feel: "If someone walked past US without saying hi, we might feel sad too. Maybe Kira was just in a rush!"
6. Name the Torah concept when relevant: "That's dan l'kaf zchus ‚Äî judging people favorably!"

Use her real people: Kira (next door), Abby (friend), baby Talia (sister), Mommy Minky, Abba Eli, Bubby Feig, cousin Ahuvah, cousin Chayala, cousin Chaya Fireman, Uncle Aryeh, Rivkah, Asher.
Labels: short clear actions like "SAY SORRY", "TAKE TURNS", "FORGIVE HER", "HOLD HER HAND", "SHARE", "WAIT".`},

parsha:{
name:"Parsha",emoji:"üïé",color:"#C4A265",
prompt:`MODE: PARSHA (Weekly Torah Portion)
Teach Sari a fun, kid-friendly story from this week's Parsha (Torah portion).

STRUCTURE:
1. First message: "This week's Parsha is [name]! Let me tell you an AMAZING story!" + a short exciting setup (2 sentences). Then ask an easy question about what she already knows.
2. Tell the story in kid-friendly chunks, with questions every 2 messages
3. Questions should be about the story: "What did Hashem tell Noach to build?" ‚Üí "A TEIVAH" / "A HOUSE" / "A TENT"
4. Connect to her life: "Just like Avraham was kind to guests, we can be kind to guests too! Just like when cousin Ahuvah comes over!"
5. Mix story questions with middos connections
6. End with: "Now you can tell Abba at the Shabbos table!"

PARSHA CYCLE (pick based on time of year, or use the seed to vary):
Bereishis, Noach, Lech Lecha, Vayeira, Chayei Sarah, Toldos, Vayeitzei, Vayishlach, Vayeishev, Mikeitz, Vayigash, Vayechi, Shemos, Va'eira, Bo, Beshalach, Yisro, Mishpatim, Terumah, Tetzaveh, Ki Sisa, Vayakhel, Pekudei, Vayikra, Tzav, Shmini, Tazria, Metzora, Acharei Mos, Kedoshim, Emor, Behar, Bechukosai, Bamidbar, Naso, Beha'aloscha, Shelach, Korach, Chukas, Balak, Pinchas, Mattos, Masei, Devarim, Va'eschanan, Eikev, Re'eh, Shoftim, Ki Seitzei, Ki Savo, Nitzavim, Vayelech, Haazinu, V'Zos HaBracha

KEY STORIES kids love: Noach's teivah, Avraham's hachnasas orchim, Yaakov's ladder dream, Yosef's coat, Moshe in the basket, Krias Yam Suf, Matan Torah, the Mishkan

Keep it SIMPLE ‚Äî she's 6. Use names she knows from school.
Labels: short answers like "A TEIVAH", "MOSHE", "HASHEM", "10 MAKOS", "SHABBOS".`},

brachos:{
name:"Brachos",emoji:"üçé",color:"#4CAF50",
prompt:`MODE: BRACHOS (Blessings on Food)
Teach Sari which bracha to make on different foods. This is practical ‚Äî she does this every day!

THE 6 BRACHOS:
- HAMOTZI: Bread, challah, rolls, pita
- MEZONOS: Cake, cookies, pasta, cereal, crackers, pretzels, pizza crust, oatmeal
- HA'EITZ: Fruits that grow on trees (apples, oranges, grapes, cherries, pears, peaches, plums)
- HA'ADAMAH: Vegetables & things from the ground (carrots, potatoes, bananas, strawberries, watermelon, corn, peanuts)
- SHEHAKOL: Meat, fish, eggs, milk, water, juice, candy, chocolate, ice cream, cheese
- HA'GAFEN: Grape juice, wine

ACTIVITY TYPES (mix it up):
1. WHAT BRACHA: Show a food ‚Üí "What bracha on an apple?" ‚Üí "HA'EITZ" / "HA'ADAMAH" / "SHEHAKOL"
2. WHICH FOOD: "Which food is Ha'Adamah?" ‚Üí "CARROT" / "APPLE" / "COOKIE"
3. TRICKY ONES: "Banana grows on a plant, not a tree! So it's..." ‚Üí "HA'ADAMAH" / "HA'EITZ"
4. SHABBOS TABLE: "Abba makes kiddush on grape juice. What bracha?" ‚Üí "HA'GAFEN"
5. STORY: "Mommy packed Sari's lunch: a sandwich, an apple, and juice. Which bracha does she make FIRST?" ‚Üí "HAMOTZI" (bread always first!)
6. ORDER: "After eating bread, do you need separate brachos on other foods?" ‚Üí "NO" / "YES" (Hamotzi covers the meal!)

Use her family: "Bubby's famous kugel ‚Äî what bracha?" (Mezonos) "Abba's Shabbos challah?" (Hamotzi)
Put the food emoji in the "emoji" field.
Labels: bracha names like "HAMOTZI", "MEZONOS", "HA'EITZ", "HA'ADAMAH", "SHEHAKOL", "HA'GAFEN" or food names.`},

riddles:{
name:"Riddles",emoji:"üß©",color:"#FF5252",
prompt:`MODE: RIDDLES & BRAIN GAMES (pure fun!)
This is the FUN mode. Sari should giggle and feel clever. Mix riddles, patterns, and brain teasers.

ACTIVITY TYPES (pick randomly):
1. CLASSIC RIDDLE: "I'm yellow, I'm curved, monkeys love me. What am I?" ‚Üí "BANANA" / "MOON" / "CHEESE"
2. WHAT AM I: "I have hands but can't clap. I have a face but can't smile. What am I?" ‚Üí "CLOCK" / "DOLL" / "ROBOT"
3. PATTERN: "Red, Blue, Red, Blue, Red, ___?" ‚Üí "BLUE" / "GREEN" / "RED"
4. WHICH DOESN'T BELONG: "Apple, Banana, Chair, Orange ‚Äî which one doesn't belong?" ‚Üí "CHAIR"
5. COUNTING RIDDLE: "I have 4 legs but I'm not alive. What am I?" ‚Üí "TABLE" / "DOG" / "SPIDER"
6. SILLY QUESTION: "What has ears but can't hear?" ‚Üí "CORN" / "RABBIT" / "CAT"
7. NUMBER PUZZLE: "If you have 5 fingers on one hand, how many on two hands?" ‚Üí "10" / "5" / "15"
8. JEWISH RIDDLE: "I'm round and braided, I'm on every Shabbos table. What am I?" ‚Üí "CHALLAH" / "KUGEL" / "PLATE"
9. WHAT COMES NEXT: "Monday, Tuesday, Wednesday, ___?" ‚Üí "THURSDAY" / "FRIDAY" / "SATURDAY"
10. LOGIC: "Sari is taller than Talia. Kira is taller than Sari. Who is tallest?" ‚Üí "KIRA" / "SARI" / "TALIA"

Make her feel SMART when she gets it right. Use lots of excitement.
When she gets it wrong, give a hint and make it fun: "Good guess! Here's a hint..."
Labels: short answers, 1-2 words max.`},

imagine:{
name:"Imagine",emoji:"üé®",color:"#E040FB",
prompt:`MODE: IMAGINE (Creative Collaborative Storytelling)
This is DIFFERENT from Book Time. In Book Time, Morah tells the story. In Imagine, SARI creates the story and Morah builds around her choices!

STRUCTURE:
1. First message: "Let's make a story TOGETHER! You pick and I'll tell it!"
   Give a fun choice: "Who should our story be about?"
   Options: "A MAGIC BUNNY" / "PRINCESS SARI" / "A TALKING FISH" / "A BRAVE KITTEN"
   (all correct:true ‚Äî she picks the plot!)

2. Next: "Where should [character] go?"
   Options: "THE MOON" / "A CASTLE" / "ERETZ YISRAEL" / "PIZZA LAND"
   (all correct:true)

3. Then: "Oh no! Something happened! What?"
   Options: "LOST THE WAY" / "FOUND A TREASURE" / "MET A DRAGON"
   (all correct:true)

4. Morah weaves a 3-4 sentence paragraph incorporating Sari's choice, then asks the next creative question.

5. After 4-5 choices: "How should the story end?"
   Options: "HAPPY PARTY" / "FOUND A FRIEND" / "WENT HOME TO FAMILY"
   (all correct:true)

6. Final message: Wrap up the story beautifully, mention Sari as the author: "And that's the story SARI wrote! You're an amazing author!"

CRITICAL: ALL options should be correct:true since these are creative choices, not right/wrong answers.
Make it silly, imaginative, and personal. Reference her real life when it fits naturally.
Labels: short creative choices, fun and exciting.`},

world:{
name:"Hashem's World",emoji:"üåç",color:"#26C6DA",
prompt:`MODE: HASHEM'S WORLD (Science & Nature through a Torah lens)
Teach Sari amazing facts about the world Hashem created. Every fact connects to Hashem's wisdom and design.

ACTIVITY TYPES:
1. AMAZING FACT + QUESTION: "Did you know a giraffe's tongue is 18 inches long? Why did Hashem give giraffes such long tongues?" ‚Üí "TO REACH LEAVES" / "TO LICK FRIENDS"
2. TRUE OR FALSE STYLE: "Penguins can fly. True or false?" ‚Üí "FALSE" / "TRUE"
3. WHICH ONE: "Which animal can sleep standing up?" ‚Üí "HORSE" / "CAT" / "FISH"
4. BODY WONDERS: "Your heart beats about 100,000 times a day! What does your heart pump?" ‚Üí "BLOOD" / "WATER" / "AIR"
5. NATURE: "What do bees make that we put on challah?" ‚Üí "HONEY" / "BUTTER" / "JAM"
6. SEASONS: "In winter, trees lose their leaves. In spring they grow back! What makes the leaves green?" ‚Üí "SUNLIGHT" / "RAIN" / "WIND"
7. SPACE: "How long does it take Earth to go around the sun?" ‚Üí "ONE YEAR" / "ONE DAY" / "ONE WEEK"
8. COMPARE: "Which is bigger, the Earth or the Moon?" ‚Üí "EARTH" / "MOON"

TORAH CONNECTION: After EVERY answer (right or wrong), connect to Hashem:
- "Isn't it incredible how Hashem designed giraffes to reach the tallest leaves?"
- "Hashem made your body SO amazing! It works even while you sleep!"
- "The whole beautiful world is Hashem's gift to us!"

Use simple language. She's 6 ‚Äî keep facts WOW-worthy but easy to understand.
Put a relevant emoji in the "emoji" field (animal, nature, body part).
Labels: short answers.`},

sing:{
name:"Sing Along",emoji:"üéµ",color:"#FF7043",
prompt:`MODE: SING ALONG (Jewish Songs & Music)
Test Sari's knowledge of songs she sings at school, shul, and Shabbos table.

ACTIVITY TYPES:
1. FILL THE BLANK: "Modeh Ani lefanecha, melech ___ v'kayam" ‚Üí "CHAI" / "GADOL" / "ECHAD"
2. WHAT SONG: "Shalom Aleichem, Shalom Aleichem, Shalom Aleichem ‚Äî who are we greeting?" ‚Üí "MALACHIM" / "FRIENDS" / "MOMMY"
3. WHEN DO WE SING: "When do we sing Ma Nishtana?" ‚Üí "PESACH" / "SHABBOS" / "CHANUKAH"
4. SONG KNOWLEDGE: "How many candles do we light on the LAST night of Chanukah?" ‚Üí "8" / "7" / "9"
5. MATCH THE HOLIDAY: "Dreidel dreidel dreidel ‚Äî which holiday?" ‚Üí "CHANUKAH" / "PURIM" / "SUKKOS"
6. FINISH THE LINE: "Torah Torah Torah... Torah tziva lanu ___" ‚Üí "MOSHE" / "AVRAHAM" / "HASHEM"
7. WHO SINGS IT: "Who is Sari's FAVORITE singer?" ‚Üí "MORDECHAI SHAPIRO" / "UNCLE MOISHY" / "AVRAHAM FRIED"
8. SHABBOS SONGS: "Lecha Dodi ‚Äî we welcome the ___" ‚Üí "SHABBOS QUEEN" / "MORNING" / "GUESTS"

Songs she knows: Modeh Ani, Shema, Shalom Aleichem, Lecha Dodi, Ma Nishtana, Dayenu, Dreidel, Torah Torah Torah, Al Hanisim themes, Adon Olam, Birkas Hamazon songs, Mordechai Shapiro's Abba, Dovy Meisels songs

Keep it fun and musical! Say "Let's sing!" and use musical emojis.
When she gets it right: "You could be a chazzan! Well... a chazzanit!"
Labels: short answers.`}
};

const MorahMenu=({onPick,onBack,questDone})=>{
const[ww,setWw]=useState([]);
useEffect(()=>{say("Hi Sari! What do you want to do with Morah?")},[]);
useEffect(()=>{if(!sb)return;
sb.from("answers").select("target_word,correct").eq("player_id",SB_P).then(({data})=>{
if(data){const map={};data.forEach(a=>{if(a.target_word){const w=a.target_word.toUpperCase();if(!map[w])map[w]={ok:0,total:0};map[w].total++;if(a.correct)map[w].ok++}});
const weak=[];Object.entries(map).forEach(([w,s])=>{if(s.total>=2&&s.ok/s.total<0.7)weak.push({word:w,pct:Math.round(s.ok/s.total*100)})});
weak.sort((a,b)=>a.pct-b.pct);setWw(weak.slice(0,8))}})
},[]);
const modes=["sound","rhyme","numbers","alefbeis","middos","friends","parsha","brachos","riddles","imagine","world","sing"];if(questDone)modes.push("book");
const modeDesc={sound:"Blend & read words",rhyme:"Rhyming words",numbers:"Counting & math",alefbeis:"Nekudos & reading",middos:"Kindness & mitzvos",friends:"Family & friends",parsha:"Weekly Torah story",brachos:"Blessings on food",riddles:"Brain games & fun",imagine:"Create stories",world:"Science & nature",sing:"Songs & music",book:"Story time!"};
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 16px 40px",background:BG,overflowY:"auto"}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,textAlign:"center",maxWidth:400,width:"100%"}},
React.createElement("div",{style:{width:72,height:72,borderRadius:36,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:40,margin:"0 auto 12px"}},"üë©‚Äçüè´"),
React.createElement("h2",{style:{fontSize:24,fontWeight:700,marginBottom:4}},"Ask Morah"),
React.createElement("p",{style:{color:"rgba(120,40,80,.5)",fontSize:14,marginBottom:22}},"Pick an activity!"),
// Weak words banner
ww.length>0&&React.createElement("div",{style:{background:"rgba(255,107,107,.08)",border:"1px solid rgba(255,107,107,.2)",borderRadius:16,padding:"12px 16px",marginBottom:18,textAlign:"left"}},
React.createElement("div",{style:{fontSize:12,color:"rgba(255,107,107,.8)",fontWeight:600,marginBottom:8}},"üìù Morah is focusing on these:"),
React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6}},
...ww.map(w=>React.createElement("span",{key:w.word,style:{background:"rgba(255,107,107,.12)",border:"1px solid rgba(255,107,107,.2)",borderRadius:10,padding:"4px 10px",fontSize:12,color:"rgba(120,40,80,.7)"}},w.word," ",React.createElement("span",{style:{color:"rgba(255,107,107,.7)"}},w.pct+"%"))))),
// Mode grid
React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},
...modes.map((m,i)=>{const md=MORAH_MODES[m];return React.createElement("button",{key:m,onClick:()=>{say(md.name+"!");setTimeout(()=>onPick(m),400)},style:{background:`linear-gradient(135deg,${md.color}18,${md.color}08)`,border:`1.5px solid ${md.color}44`,borderRadius:20,padding:"16px 14px",display:"flex",flexDirection:"column",alignItems:"center",gap:6,textAlign:"center",animation:`slideUp .3s ease-out ${i*.06}s both`}},
React.createElement("div",{style:{fontSize:32}},md.emoji),
React.createElement("div",{style:{fontSize:14,fontWeight:700}},md.name),
React.createElement("div",{style:{fontSize:11,color:"rgba(120,40,80,.45)"}},modeDesc[m]))}),
!questDone&&React.createElement("div",{style:{background:"rgba(200,180,190,.2)",border:"1px solid rgba(220,120,170,.15)",borderRadius:20,padding:"16px 14px",display:"flex",flexDirection:"column",alignItems:"center",gap:6,opacity:.35}},
React.createElement("div",{style:{fontSize:32}},"üìö"),
React.createElement("div",{style:{fontSize:14,fontWeight:700}},"Book Time"),
React.createElement("div",{style:{fontSize:11,color:"rgba(120,40,80,.45)"}},"Finish quest üîí"))),
React.createElement("button",{onClick:onBack,style:{background:"rgba(255,255,255,.75)",border:"1px solid rgba(220,120,170,.15)",borderRadius:16,padding:"14px 28px",fontSize:15,marginTop:14,gridColumn:"1 / -1"}},"‚Üê Back to Home")))};
const MorahChat=({mode,onBack})=>{
const[msgs,setMsgs]=useState([]);const[cur,setCur]=useState(null);const[loading,setLoading]=useState(true);const[done,setDone]=useState(false);const[result,setResult]=useState(null);
const chatRef=useRef(null);const histRef=useRef([]);const qCount=useRef(0);const qCorrect=useRef(0);const initCalled=useRef(false);
const QLIMIT=(mode==="book"||mode==="imagine")?999:8;
const md=MORAH_MODES[mode];

const callClaude=async(userMsg)=>{
try{
const sysMsg=MORAH_BASE+"\n\n"+md.prompt+(wwRef.current.length?"\n\nSARI'S WEAK WORDS (focus on these): "+wwRef.current.join(", "):"");
const newHist=[...histRef.current];
if(userMsg)newHist.push({role:"user",content:userMsg});
const rSeed=Math.floor(Math.random()*100);
const startMsg=mode==="book"?"Hi Morah! Read me a story! [seed:"+rSeed+"]":mode==="rhyme"?"Hi Morah! Let's do rhymes! [seed:"+rSeed+"]":mode==="numbers"?"Hi Morah! Let's practice numbers! [seed:"+rSeed+"]":mode==="alefbeis"?"Hi Morah! Let's read Hebrew! [seed:"+rSeed+"]":mode==="middos"?"Hi Morah! Teach me about middos! [seed:"+rSeed+"]":mode==="friends"?"Hi Morah! Let's learn about being a good friend and sister! [seed:"+rSeed+"]":mode==="parsha"?"Hi Morah! Tell me about this week's Parsha! [seed:"+rSeed+"]":mode==="brachos"?"Hi Morah! Let's practice brachos! [seed:"+rSeed+"]":mode==="riddles"?"Hi Morah! Tell me a riddle! [seed:"+rSeed+"]":mode==="imagine"?"Hi Morah! Let's make up a story together! [seed:"+rSeed+"]":mode==="world"?"Hi Morah! Tell me something amazing about Hashem's world! [seed:"+rSeed+"]":mode==="sing"?"Hi Morah! Let's do songs! [seed:"+rSeed+"]":"Hi Morah! Let's read some words! [seed:"+rSeed+"]";
// If no history yet, start with the greeting
const msgsToSend=newHist.length?newHist:[{role:"user",content:startMsg}];
// Sonnet 4.6: conversation MUST end with user message
if(msgsToSend[msgsToSend.length-1].role!=="user"){msgsToSend.push({role:"user",content:"Next question please!"})}
const r=await fetch("/api/claude",{method:"POST",headers:{"Content-Type":"application/json"},
signal:AbortSignal.timeout(15000),
body:JSON.stringify({model:"claude-sonnet-4-5-20250929",max_tokens:mode==="book"?800:300,system:sysMsg,messages:msgsToSend})});
if(!r.ok){const e=await r.json();console.error("Morah API error:",e);setCur({say:e.error==="API key not configured"?"Ask Abba to add the AI key in Vercel settings!":"Oops! "+e.error,emoji:"üß†"});setLoading(false);return}
const d=await r.json();
const txt=d.content?d.content.map(c=>c.text||"").join(""):"";
let parsed=null;try{
// Strip ALL markdown fencing variations
let clean=txt.replace(/```json/gi,"").replace(/```/g,"").replace(/`/g,"").trim();
// Try 1: direct parse
try{parsed=JSON.parse(clean)}catch{}
// Try 2: find first complete JSON object with "say"
if(!parsed||!parsed.say){
const sayIdx=clean.indexOf('"say"');
if(sayIdx>=0){const braceIdx=clean.lastIndexOf("{",sayIdx);
if(braceIdx>=0){let depth=0;let end=-1;for(let i=braceIdx;i<clean.length;i++){if(clean[i]==="{")depth++;if(clean[i]==="}"){depth--;if(depth===0){end=i;break}}}
if(end>braceIdx){try{parsed=JSON.parse(clean.slice(braceIdx,end+1))}catch{}}}}
}
// Try 3: find ANY JSON object
if(!parsed||!parsed.say){
const ji=clean.indexOf("{");const jl=clean.lastIndexOf("}");
if(ji>=0&&jl>ji){try{parsed=JSON.parse(clean.slice(ji,jl+1))}catch{}}
}
// Fallback: extract just the readable human text, strip ALL code artifacts
if(!parsed||!parsed.say){
let readable=txt.replace(/```json/gi,"").replace(/```/g,"").replace(/`/g,"").replace(/[\{\}"\:\[\]\\]/g,"").replace(/say |emoji |options |label |correct |true|false/gi,"").replace(/,\s*/g," ").replace(/\s+/g," ").trim();
if(readable.length>10){parsed={say:readable.slice(0,180),emoji:"üéØ"}}
else{parsed={say:"Let's try another one!",emoji:"üìñ"}}
}
}catch{parsed={say:"Let's try another one!",emoji:"üìñ"}}
const assistMsg={role:"assistant",content:JSON.stringify(parsed)};
histRef.current=[...msgsToSend,assistMsg];setCur(parsed);setLoading(false);
if(parsed.say){
// Combine question + options into ONE utterance (iOS can't queue multiple)
if(parsed.options&&parsed.options.length>1){
const labels=parsed.options.map(o=>o.label);
const optPart=labels.map((l,i)=>String.fromCharCode(65+i)+", "+l).join(". ");
const full=parsed.say+" ... "+optPart;
fbSay(full,.75);
}else{say(parsed.say)}}
}catch(e){setCur({say:"Oops, Morah's brain is tired! Try again.",emoji:"üò¥"});setLoading(false)}};

const[weakWords,setWeakWords]=useState([]);const wwRef=useRef([]);const wwLoaded=useRef(false);

useEffect(()=>{
if(!sb){wwLoaded.current=true;return}
// Timeout: if Supabase takes >3s, just proceed without weak words
const timeout=setTimeout(()=>{if(!wwLoaded.current){wwLoaded.current=true;console.log("Morah: weak words timeout, proceeding")}},3000);
sb.from("answers").select("target_word,correct").eq("player_id","sari").then(({data,error})=>{
clearTimeout(timeout);
if(error){console.warn("Weak words error:",error);wwLoaded.current=true;return}
if(data){const map={};data.forEach(a=>{if(a.target_word){if(!map[a.target_word])map[a.target_word]={ok:0,total:0};map[a.target_word].total++;if(a.correct)map[a.target_word].ok++}});
const ww=[];Object.entries(map).forEach(([w,s])=>{if(s.total>=2&&s.ok/s.total<0.7)ww.push(w)});
setWeakWords(ww);wwRef.current=ww;console.log("Morah weak words:",ww)}
wwLoaded.current=true})
},[]);

useEffect(()=>{
const check=setInterval(()=>{if(wwLoaded.current&&!initCalled.current){clearInterval(check);initCalled.current=true;callClaude(null)}},200);
// Safety: force start after 4s no matter what
const safety=setTimeout(()=>{clearInterval(check);if(!initCalled.current){initCalled.current=true;callClaude(null)}},4000);
return()=>{clearInterval(check);clearTimeout(safety)}},[]);
useEffect(()=>{if(chatRef.current){setTimeout(()=>{chatRef.current.scrollTop=chatRef.current.scrollHeight},100)}},[msgs,cur,loading,result]);

const tap=(opt)=>{
if(speechSynthesis)speechSynthesis.cancel();
if(result)return; // prevent double tap
const correctOpt=cur.options?cur.options.find(o=>o.correct):null;
const correctLabel=correctOpt?correctOpt.label:opt.label;
// Show result ‚Äî highlight correct green, wrong red
setResult({picked:opt.label,correct:opt.correct,correctLabel});
// Count questions
if(cur.options){qCount.current++;if(opt.correct)qCorrect.current++}
// Save to Supabase
if(sb&&opt.label){try{sb.from("answers").insert({player_id:SB_P,session_date:td(),question_num:qCount.current,game_mode:"morah_"+mode,target_word:opt.label.toLowerCase(),word_family:mode,correct:opt.correct,user_answer:opt.label,correct_answer:correctLabel}).then(()=>{})}catch(e){}}
// Read feedback aloud
if(opt.correct){say(pick(CHEERS))}
else{say("The answer is "+correctLabel+"! "+pick(TRIES))}
// After pause, move to next question
setTimeout(()=>{
const newMsg={role:"morah",text:cur.say,emoji:cur.emoji};
const sariMsg={role:"sari",text:opt.label};
setMsgs(m=>[...m,newMsg,sariMsg]);setResult(null);
// Check if session is done
if(qCount.current>=QLIMIT){setCur(null);setLoading(false);
const pct=QLIMIT>0?Math.round(qCorrect.current/QLIMIT*100):100;
const msg=pct>=90?"WOW! Perfect session Sari!":pct>=70?"Amazing job Sari!":pct>=50?"Great work Sari!":"Good try Sari!";
setTimeout(()=>{say(msg+" You got "+qCorrect.current+" out of "+QLIMIT+" right!");setDone(true)},400);return}
setLoading(true);setCur(null);
callClaude("Sari tapped: "+opt.label+(opt.correct?" (correct)":" (wrong, the answer was "+correctLabel+". Give encouragement then move on to next question)"))
},opt.correct?1800:2800)};

const tapContinue=()=>{if(speechSynthesis)speechSynthesis.cancel();setMsgs(m=>[...m,{role:"morah",text:cur.say,emoji:cur.emoji}]);setLoading(true);setCur(null);
callClaude(mode==="book"?"Sari tapped Keep Going. Continue the story with a full paragraph (3-5 sentences). Remember: most messages should be story, only pause for interaction every 2-3 paragraphs.":"Sari wants to continue")};

// Done celebration screen
if(done){const pct=QLIMIT>0?Math.round(qCorrect.current/QLIMIT*100):100;
return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,background:BG,textAlign:"center"}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,animation:"bounceIn .5s ease-out"}},
React.createElement("div",{style:{fontSize:72,marginBottom:12,animation:"float 2s ease-in-out infinite"}},pct>=90?"üèÜ":pct>=70?"üåü":"‚≠ê"),
React.createElement("div",{style:{fontSize:28,fontWeight:700,marginBottom:8}},pct>=90?"SUPERSTAR!":pct>=70?"Great Job!":"Good Try!"),
React.createElement("div",{style:{fontSize:48,fontWeight:700,color:md.color,marginBottom:6}},qCorrect.current+"/"+QLIMIT),
React.createElement("div",{style:{fontSize:16,color:"rgba(120,40,80,.6)",marginBottom:28}},pct+"% correct ¬∑ "+md.name+" session done!"),
React.createElement("div",{style:{display:"flex",gap:12,justifyContent:"center",flexWrap:"wrap"}},
React.createElement("button",{className:"quest-btn",onClick:()=>{qCount.current=0;qCorrect.current=0;histRef.current=[];setMsgs([]);setCur(null);setDone(false);setLoading(true);setTimeout(()=>callClaude(null),300)},style:{background:`linear-gradient(135deg,${md.color},${md.color}CC)`,borderRadius:20,padding:"16px 28px",fontSize:17,fontWeight:600,transition:"transform .2s ease"}},"üîÑ Play Again!"),
React.createElement("button",{onClick:()=>{if(speechSynthesis)speechSynthesis.cancel();onBack()},style:{background:"rgba(255,255,255,.75)",border:"1px solid rgba(220,120,170,.25)",borderRadius:20,padding:"16px 24px",fontSize:15,transition:"transform .2s ease"}},"üè† Home"))))}

return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:BG}},
React.createElement(Glow),
// Header
React.createElement("div",{style:{zIndex:2,display:"flex",alignItems:"center",gap:12,padding:"14px 16px 8px",flexShrink:0}},
React.createElement("button",{onClick:()=>{if(speechSynthesis)speechSynthesis.cancel();if(curAudio){curAudio.pause();curAudio=null}onBack()},style:{background:"rgba(220,120,170,.18)",borderRadius:14,width:44,height:44,fontSize:20,display:"flex",alignItems:"center",justifyContent:"center"}},"üè†"),
React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1}},
React.createElement("div",{style:{width:40,height:40,borderRadius:20,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22}},"üë©‚Äçüè´"),
React.createElement("div",null,React.createElement("div",{style:{fontSize:16,fontWeight:700}},"Morah"),React.createElement("div",{style:{fontSize:12,color:md.color}},md.emoji," ",md.name,(mode!=="book"&&mode!=="imagine")?" ¬∑ "+Math.min(qCount.current,QLIMIT)+"/"+QLIMIT:"")))),
// Scrollable content area - messages + buttons together
React.createElement("div",{ref:chatRef,style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"8px 16px",zIndex:2,display:"flex",flexDirection:"column"}},
// History
...msgs.map((m,i)=>m.role==="morah"?
React.createElement("div",{key:i,style:{display:"flex",gap:10,marginBottom:14}},
React.createElement("div",{style:{width:36,height:36,borderRadius:18,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}},"üë©‚Äçüè´"),
React.createElement("div",{style:{background:"rgba(255,255,255,.75)",borderRadius:"4px 18px 18px 18px",padding:"12px 16px",maxWidth:"82%"}},
m.emoji&&React.createElement("div",{style:{fontSize:34,marginBottom:4}},m.emoji),
React.createElement("div",{style:{fontSize:16,lineHeight:1.6}},m.text))):
React.createElement("div",{key:i,style:{display:"flex",justifyContent:"flex-end",marginBottom:14}},
React.createElement("div",{style:{background:`linear-gradient(135deg,${md.color}22,${md.color}11)`,border:`1px solid ${md.color}44`,borderRadius:"18px 4px 18px 18px",padding:"10px 18px",fontSize:16,fontWeight:600}},m.text))),
// Current message
cur&&React.createElement("div",{style:{display:"flex",gap:10,marginBottom:14,animation:"slideUp .3s ease-out"}},
React.createElement("div",{style:{width:36,height:36,borderRadius:18,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}},"üë©‚Äçüè´"),
React.createElement("div",{style:{background:"rgba(255,255,255,.75)",borderRadius:"4px 18px 18px 18px",padding:"12px 16px",maxWidth:"85%"}},
cur.emoji&&React.createElement("div",{style:{fontSize:48,marginBottom:6}},cur.emoji),
React.createElement("div",{style:{fontSize:17,lineHeight:1.7}},cur.say))),
// Loading bubble with animated messages
loading&&React.createElement("div",{style:{display:"flex",gap:10,marginBottom:12}},
React.createElement("div",{style:{width:36,height:36,borderRadius:18,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0,animation:"pulse 1.5s ease-in-out infinite"}},"üë©‚Äçüè´"),
React.createElement("div",{style:{background:"rgba(255,255,255,.75)",borderRadius:"4px 18px 18px 18px",padding:"14px 18px",display:"flex",alignItems:"center",gap:10}},
React.createElement("span",{style:{fontSize:14,color:"rgba(120,40,80,.6)",animation:"pulse 1.5s ease-in-out infinite"}},pick(["Morah is thinking...","Getting ready...","Almost there...","One moment..."])),
React.createElement("span",{style:{display:"flex",gap:4}},...[0,1,2].map(d=>React.createElement("span",{key:d,style:{width:8,height:8,borderRadius:4,background:md.color,opacity:.6,animation:`pulse 1s ease-in-out ${d*.2}s infinite`}}))))),
// Buttons ‚Äî right after message, inside scroll area
!loading&&cur&&React.createElement("div",{style:{padding:"8px 0 24px"}},
cur.options?React.createElement("div",null,
React.createElement("div",{style:{textAlign:"center",fontSize:13,color:"rgba(120,40,80,.45)",marginBottom:10,animation:"pulse 2s ease-in-out infinite"}},"Tap your answer!"),
React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10,maxWidth:360,margin:"0 auto"}},
...cur.options.map((opt,i)=>{
const isCorrect=result&&opt.correct;
const isWrong=result&&opt.label===result.picked&&!opt.correct;
const dim=result&&!isCorrect&&!isWrong;
return React.createElement("button",{key:i,onClick:()=>tap(opt),style:{background:isCorrect?"linear-gradient(145deg,#d4f5d4,#b8eab8)":isWrong?"linear-gradient(145deg,#f5d4d4,#eab8b8)":"linear-gradient(145deg,#FFFFFF,#FFF0F5)",
border:isCorrect?"2.5px solid #22BB66":isWrong?"2.5px solid #DD4444":`2.5px solid ${md.color}44`,
borderRadius:20,padding:"16px 20px",fontSize:"clamp(18px,5vw,24px)",fontWeight:700,minHeight:56,width:"100%",
animation:isCorrect?"pulse .5s ease-in-out":isWrong?"shake .5s ease-in-out":`popIn .3s ease-out ${i*.1}s both`,
transition:"transform .2s ease,border-color .2s ease,background .2s ease",display:"flex",alignItems:"center",gap:12,
opacity:dim?.4:1,pointerEvents:result?"none":"auto"}},
React.createElement("span",{style:{fontSize:13,fontWeight:700,color:isCorrect?"#22BB66":isWrong?"#FF4444":md.color,opacity:.7,minWidth:20}},String.fromCharCode(65+i)),
React.createElement("span",{style:{flex:1,textAlign:"left"}},opt.label),
isCorrect&&React.createElement("span",{style:{fontSize:22}},"‚úÖ"),
isWrong&&React.createElement("span",{style:{fontSize:22}},"‚ùå"))}))):
React.createElement("div",{style:{display:"flex",gap:10,justifyContent:"center",flexWrap:"wrap"}},
React.createElement("button",{onClick:tapContinue,style:{background:`linear-gradient(135deg,${md.color},${md.color}CC)`,borderRadius:20,padding:"18px 32px",fontSize:18,fontWeight:600,minHeight:56,animation:"popIn .3s ease-out"}},mode==="book"||mode==="imagine"?"Keep going!":"Next!"),
React.createElement("button",{onClick:()=>{say("Bye Sari! Great job!");setTimeout(onBack,1500)},style:{background:"rgba(255,255,255,.75)",border:"1px solid rgba(220,120,170,.25)",borderRadius:20,padding:"18px 24px",fontSize:15,minHeight:56}},"Done"))))
)
};

// ‚ïê‚ïê‚ïê HOME ‚Äî SARI'S PLAYHOUSE ‚ïê‚ïê‚ïê
// Daily rotation: pick 4 modes based on date
const ROOM_OBJECTS={
sound:{obj:"üî§",spot:"ABC Blocks",where:"floor-left"},
rhyme:{obj:"üé∂",spot:"Music Box",where:"shelf-right"},
numbers:{obj:"üßÆ",spot:"Counting Beads",where:"desk-left"},
alefbeis:{obj:"üìù",spot:"Chalkboard",where:"wall-right"},
middos:{obj:"üíõ",spot:"Heart Frame",where:"wall-left"},
friends:{obj:"üëØ",spot:"Friends Photo",where:"shelf-left"},
parsha:{obj:"üìú",spot:"Torah Scroll",where:"shelf-right"},
brachos:{obj:"üç™",spot:"Cookie Plate",where:"table"},
riddles:{obj:"üß©",spot:"Puzzle",where:"floor-right"},
imagine:{obj:"üñçÔ∏è",spot:"Crayons",where:"art-corner"},
world:{obj:"üåé",spot:"Globe",where:"desk-right"},
sing:{obj:"üéπ",spot:"Piano",where:"floor-left"},
book:{obj:"üìñ",spot:"Storybook",where:"nook"}
};
const MODE_CATS={learning:["sound","rhyme","numbers","alefbeis"],jewish:["middos","friends","parsha","brachos","sing"],fun:["riddles","imagine","world"]};
const getDailyModes=(dateStr,questDone)=>{
// Better hash: multiply by primes for each category
let h=0;for(let i=0;i<dateStr.length;i++)h=((h<<5)-h)+dateStr.charCodeAt(i);h=Math.abs(h);
const pickFrom=(arr,seed)=>arr[Math.abs(seed)%arr.length];
const m1=pickFrom(MODE_CATS.learning,h*7);
const m2=pickFrom(MODE_CATS.jewish,h*13+3);
const m3=pickFrom(MODE_CATS.fun,h*19+7);
// Wildcard: pick from all, avoid duplicates
const all=[...MODE_CATS.learning,...MODE_CATS.jewish,...MODE_CATS.fun].filter(m=>m!==m1&&m!==m2&&m!==m3);
const m4=pickFrom(all,h*31+11);
const result=[m1,m2,m3,m4];
if(questDone&&!result.includes("book")){result[3]="book"}
return result};

// 20-minute timer helper
const TIMER_LIMIT=1200; // 20 minutes in seconds

const Home=({prog,onQ,onP,onMorah})=>{
const dn=prog.last===td();
const nx=PRIZES.find(p=>p.s>prog.stars)||PRIZES[PRIZES.length-1];
const ps=([...PRIZES].reverse().find(p=>p.s<=prog.stars)||{s:0}).s;
const rng=nx.s-ps;const pct=rng>0?Math.min(100,((prog.stars-ps)/rng)*100):100;
const dailyModes=getDailyModes(td(),dn);
// Read timer from localStorage (fresh) instead of props (stale after navigation)
const getTimerSecs=()=>{try{const p=JSON.parse(localStorage.getItem(SK)||"{}");return(p.timerDate===td())?(p.timerSecs||0):0}catch{return 0}};
const initSecs=getTimerSecs();
const[timer,setTimer]=useState(initSecs);
const[timeUp,setTimeUp]=useState(initSecs>=TIMER_LIMIT);
const[showAll,setShowAll]=useState(false);
const timerRef=useRef(null);
const saveCountRef=useRef(0);
const timeUpFired=useRef(initSecs>=TIMER_LIMIT);

// Timer tick ‚Äî saves to Supabase every 10 seconds
useEffect(()=>{
if(timeUpFired.current){setTimeUp(true);return}
timerRef.current=setInterval(()=>{
setTimer(prev=>{
const cur=prev+1;
saveCountRef.current++;
if(saveCountRef.current>=10){saveCountRef.current=0;svTimer(cur)}
if(cur>=TIMER_LIMIT&&!timeUpFired.current){timeUpFired.current=true;setTimeUp(true);svTimer(cur);say("Amazing day Sari! Morah says see you tomorrow!");clearInterval(timerRef.current);timerRef.current=null}
return cur});
},1000);
return()=>{if(timerRef.current)clearInterval(timerRef.current)}},[]);

const fiveMore=()=>{say("5 more minutes!");setTimeUp(false);timeUpFired.current=false;
const newT=Math.max(0,timer-300);setTimer(newT);svTimer(newT);
// Restart interval if it was stopped
if(!timerRef.current){timerRef.current=setInterval(()=>{
setTimer(prev=>{const cur=prev+1;saveCountRef.current++;
if(saveCountRef.current>=10){saveCountRef.current=0;svTimer(cur)}
if(cur>=TIMER_LIMIT&&!timeUpFired.current){timeUpFired.current=true;setTimeUp(true);svTimer(cur);say("Amazing day Sari! Morah says see you tomorrow!");clearInterval(timerRef.current);timerRef.current=null}
return cur});},1000)}};

useEffect(()=>{const g=["Welcome to your playhouse Sari!","Hi Sari! Morah left surprises for you!","Sari's back! Let's see what's here today!","Welcome home Sari!"];
setTimeout(()=>say(pick(g)+" You have "+prog.stars+" stars!"),500)},[]);

const sunPct=Math.min(100,timer/TIMER_LIMIT*100);
const minsLeft=Math.max(0,Math.ceil((TIMER_LIMIT-timer)/60));

// All modes for parent "See All" panel
const allModes=[{id:"sound",emoji:"üìñ",name:"Read Words",color:"#FF3B8B"},{id:"rhyme",emoji:"üéµ",name:"Rhyme Time",color:"#B44BFF"},{id:"numbers",emoji:"üî¢",name:"Numbers",color:"#22BB66"},{id:"alefbeis",emoji:"‚ú°Ô∏è",name:"Alef-Beis",color:"#E8D44D"},{id:"middos",emoji:"üíõ",name:"Middos",color:"#FFB347"},{id:"friends",emoji:"ü§ù",name:"Friends",color:"#FF6B9D"},{id:"parsha",emoji:"üïé",name:"Parsha",color:"#C4A265"},{id:"brachos",emoji:"üçé",name:"Brachos",color:"#4CAF50"},{id:"riddles",emoji:"üß©",name:"Riddles",color:"#FF5252"},{id:"imagine",emoji:"üé®",name:"Imagine",color:"#E040FB"},{id:"world",emoji:"üåç",name:"Hashem's World",color:"#26C6DA"},{id:"sing",emoji:"üéµ",name:"Sing Along",color:"#FF7043"},{id:"book",emoji:"üìö",name:"Book Time",color:"#FF9500"}];

// Time's up celebration
if(timeUp&&!showAll){return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,background:"linear-gradient(180deg,#FFD6EC 0%,#FFF0F8 50%,#E8D0FF 100%)",textAlign:"center"}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,maxWidth:400}},
React.createElement("div",{style:{fontSize:80,marginBottom:16,animation:"bounceIn .5s ease-out"}},"üåô"),
React.createElement("h2",{style:{fontSize:28,fontWeight:700,marginBottom:8,color:"#C050A0"}},"Amazing Day Sari! üíñ"),
React.createElement("div",{style:{fontSize:16,color:"rgba(180,60,120,.6)",marginBottom:8}},"You played for 20 minutes today!"),
React.createElement("div",{style:{fontSize:16,color:"rgba(180,60,120,.6)",marginBottom:28}},"Morah says see you tomorrow! üåü"),
React.createElement("div",{style:{display:"flex",gap:12,justifyContent:"center",flexWrap:"wrap"}},
React.createElement("button",{onClick:fiveMore,style:{background:"rgba(255,255,255,.8)",border:"1.5px solid rgba(255,105,180,.3)",borderRadius:20,padding:"14px 24px",fontSize:15,boxShadow:"0 2px 8px rgba(255,105,180,.15)"}},"5 more minutes? üíï"),
React.createElement("button",{onClick:()=>{window.location.href="/dashboard"},style:{background:"rgba(255,255,255,.6)",border:"1px solid rgba(220,120,170,.2)",borderRadius:20,padding:"14px 24px",fontSize:13,color:"rgba(120,40,80,.5)"}},"Parent Dashboard"))))}

// Parent "See All" panel
if(showAll){return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",padding:"20px 16px 40px",background:BG,overflowY:"auto"}},
React.createElement(Glow),
React.createElement("div",{style:{zIndex:2,width:"100%",maxWidth:440,margin:"0 auto"}},
React.createElement("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20}},
React.createElement("button",{onClick:()=>setShowAll(false),style:{background:"rgba(220,120,170,.18)",borderRadius:14,width:44,height:44,fontSize:20,display:"flex",alignItems:"center",justifyContent:"center"}},"üè†"),
React.createElement("h2",{style:{fontSize:20,fontWeight:700}},"All Activities")),
React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}},
...allModes.map((m,i)=>{const locked=m.id==="book"&&!dn;
return React.createElement("button",{key:m.id,className:"mode-btn",onClick:()=>{if(locked){say("Finish quest first!");return}say(m.name+"!");setTimeout(()=>onMorah(m.id),400)},style:{background:locked?"rgba(120,40,80,.5)":"linear-gradient(135deg,"+m.color+"14,"+m.color+"06)",border:locked?"1px solid rgba(255,255,255,.6)":"1.5px solid "+m.color+"33",borderRadius:16,padding:"14px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:4,textAlign:"center",opacity:locked?.35:1,animation:"slideUp .3s ease-out "+i*.04+"s both",transition:"transform .15s ease,filter .15s ease"}},
React.createElement("div",{style:{fontSize:28}},m.emoji),
React.createElement("div",{style:{fontSize:12,fontWeight:700,lineHeight:1.2}},m.name))})),
React.createElement("button",{onClick:()=>{window.location.href="/dashboard"},style:{background:"rgba(255,255,255,.6)",border:"1px solid rgba(220,120,170,.18)",borderRadius:16,padding:"14px 28px",fontSize:13,marginTop:16,width:"100%",color:"rgba(120,40,80,.5)"}},"Parent Dashboard")))}

// ‚ïê‚ïê‚ïê THE PLAYHOUSE ‚ïê‚ïê‚ïê
const objPositions=[
{top:"2%",left:"8%",delay:0},  // top-left
{top:"2%",right:"8%",delay:.1}, // top-right
{bottom:"2%",left:"8%",delay:.2}, // bottom-left
{bottom:"2%",right:"8%",delay:.3}  // bottom-right
];

return React.createElement("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:"linear-gradient(180deg,#FFD6EC 0%,#FFF0F8 30%,#FFE8F5 60%,#FFD6EC 100%)",position:"relative",overflow:"hidden"}},

// ‚îÄ‚îÄ Floating sparkle dots ‚îÄ‚îÄ
React.createElement("div",{style:{position:"absolute",inset:0,zIndex:0,pointerEvents:"none"}},
...[0,1,2,3,4,5,6,7,8,9].map(i=>React.createElement("div",{key:i,style:{position:"absolute",left:Math.floor((i*17+5)%100)+"%",top:Math.floor((i*23+10)%90)+"%",width:4+i%3*3,height:4+i%3*3,borderRadius:"50%",background:["#FF69B4","#FFB6C1","#FF85C8","#DDA0DD","#FFD700","#FF69B4","#C875FF","#FFB6C1","#FF69B4","#FFD700"][i],animation:`sparkle ${2+i*.4}s ease-in-out ${i*.5}s infinite`,opacity:.4}}))),

// ‚îÄ‚îÄ Top bar with hearts ‚îÄ‚îÄ
React.createElement("div",{style:{zIndex:3,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px 0",flexShrink:0}},
React.createElement("button",{onClick:()=>setShowAll(true),style:{background:"rgba(255,255,255,.7)",borderRadius:14,width:40,height:40,fontSize:16,display:"flex",alignItems:"center",justifyContent:"center",border:"1.5px solid rgba(255,105,180,.2)",boxShadow:"0 2px 8px rgba(255,105,180,.1)"}},"‚öôÔ∏è"),
React.createElement("div",{style:{textAlign:"center"}},
React.createElement("div",{style:{fontSize:11,color:"rgba(180,60,120,.5)",fontWeight:600}},"üíñ Sari's Playhouse üíñ"),
React.createElement("div",{style:{fontSize:22,fontWeight:700,background:"linear-gradient(90deg,#FF69B4,#FFD700,#FF69B4)",backgroundSize:"200% auto",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",animation:"shimmer 3s linear infinite"}},"‚≠ê ",prog.stars," stars")),
React.createElement("div",{style:{display:"flex",gap:6}},
prog.streak>0&&React.createElement("div",{style:{background:"rgba(255,255,255,.8)",borderRadius:12,padding:"4px 10px",display:"flex",alignItems:"center",gap:3,border:"1.5px solid rgba(255,149,0,.25)",boxShadow:"0 2px 6px rgba(255,149,0,.1)"}},React.createElement("span",{style:{fontSize:14}},"üî•"),React.createElement("span",{style:{fontSize:14,fontWeight:700,color:"#FF6B00"}},prog.streak)),
React.createElement("button",{onClick:()=>{say("Prizes!");setTimeout(onP,400)},style:{background:"rgba(255,255,255,.8)",borderRadius:12,padding:"4px 10px",border:"1.5px solid rgba(255,59,139,.25)",fontSize:18,boxShadow:"0 2px 6px rgba(255,59,139,.1)"}},"üéÅ"))),

// ‚îÄ‚îÄ TIMER BAR ‚Äî big, visible, pink gradient ‚îÄ‚îÄ
React.createElement("div",{style:{margin:"10px 16px 0",zIndex:2}},
React.createElement("div",{style:{background:"rgba(255,255,255,.7)",borderRadius:16,padding:"10px 14px",border:"1.5px solid rgba(255,105,180,.2)",boxShadow:"0 2px 10px rgba(255,105,180,.08)"}},
React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},
React.createElement("span",{style:{fontSize:20}},sunPct<100?"‚òÄÔ∏è":"üåô"),
React.createElement("span",{style:{fontSize:12,fontWeight:700,color:"rgba(180,60,120,.6)"}},minsLeft>0?minsLeft+" min left":"Time's up!"),
React.createElement("span",{style:{fontSize:11,color:"rgba(180,60,120,.35)"}},Math.floor(timer/60)+"m played")),
React.createElement("div",{style:{background:"rgba(255,182,193,.3)",borderRadius:8,height:10,overflow:"hidden"}},
React.createElement("div",{style:{height:"100%",borderRadius:8,background:"linear-gradient(90deg,#FF69B4,#FF85C8,#C875FF)",width:sunPct+"%",transition:"width 1s linear",boxShadow:"0 0 8px rgba(255,105,180,.4)"}})))),

// ‚îÄ‚îÄ Main playhouse area ‚îÄ‚îÄ
React.createElement("div",{style:{flex:1,position:"relative",zIndex:2,padding:"8px 16px",display:"flex",flexDirection:"column",justifyContent:"center",gap:14,minHeight:0}},

// ‚îÄ‚îÄ Prize progress (compact with hearts) ‚îÄ‚îÄ
React.createElement("button",{onClick:()=>say(Math.round(pct)+"% to "+nx.n),style:{background:"rgba(255,255,255,.85)",borderRadius:14,padding:"10px 14px",border:"1.5px solid rgba(255,105,180,.2)",width:"100%",textAlign:"left",boxShadow:"0 2px 10px rgba(255,105,180,.08)"}},
React.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:5}},
React.createElement("span",{style:{color:"rgba(180,60,120,.5)",fontSize:11,fontWeight:600}},"üí´ Next prize"),
React.createElement("span",{style:{fontSize:12,color:"rgba(180,60,120,.7)",fontWeight:600}},nx.e," ",nx.s,"‚≠ê")),
React.createElement("div",{style:{background:"rgba(255,182,193,.3)",borderRadius:6,height:10,overflow:"hidden"}},
React.createElement("div",{style:{height:"100%",borderRadius:6,background:"linear-gradient(90deg,#FF69B4,#FFD700)",width:pct+"%",boxShadow:"0 0 10px rgba(255,105,180,.4)"}}))),

// ‚îÄ‚îÄ The Door (Quest) ‚îÄ‚îÄ
dn?React.createElement("button",{className:"quest-btn",onClick:()=>{say("Practice time!");setTimeout(onQ,600)},style:{background:"rgba(255,255,255,.85)",borderRadius:22,padding:"16px",textAlign:"center",border:"1.5px solid rgba(34,187,102,.3)",boxShadow:"0 3px 12px rgba(34,187,102,.1)",transition:"transform .15s ease"}},
React.createElement("div",{style:{fontSize:36,marginBottom:4}},"‚úÖ"),
React.createElement("div",{style:{fontSize:16,fontWeight:700,color:"#1FA055"}},"Quest Done! üéâ"),
React.createElement("div",{style:{fontSize:12,color:"rgba(120,80,40,.5)",marginTop:2}},"Tap to practice again"))
:React.createElement("button",{className:"quest-btn",onClick:()=>{say("Let's go!");setTimeout(onQ,600)},style:{background:"linear-gradient(135deg,#FF69B4,#FF85C8,#C875FF)",borderRadius:22,padding:"18px 16px",width:"100%",textAlign:"center",border:"2px solid rgba(255,255,255,.4)",boxShadow:"0 6px 25px rgba(255,105,180,.35),inset 0 1px 0 rgba(255,255,255,.3)",animation:"glow 2.5s ease-in-out infinite",transition:"transform .15s ease",color:"#fff"}},
React.createElement("div",{style:{fontSize:40,marginBottom:4,animation:"float 3s ease-in-out infinite"}},"üö™"),
React.createElement("div",{style:{fontSize:18,fontWeight:700,color:"#fff"}},"‚ú® Today's Quest! ‚ú®"),
React.createElement("div",{style:{display:"flex",justifyContent:"center",gap:6,opacity:.8,marginTop:4}},...STG.map(s=>React.createElement("span",{key:s.id,style:{fontSize:16}},s.em))),
React.createElement("div",{style:{fontSize:11,color:"rgba(255,255,255,.7)",marginTop:2}},"4 games ¬∑ earn stars!")),

// ‚îÄ‚îÄ Morah's Surprise Label ‚îÄ‚îÄ
React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
React.createElement("div",{style:{width:30,height:30,borderRadius:15,background:"linear-gradient(135deg,#FFD700,#FF9500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,boxShadow:"0 2px 6px rgba(255,149,0,.2)"}},"üë©‚Äçüè´"),
React.createElement("div",{style:{fontSize:13,fontWeight:700,color:"rgba(180,60,120,.6)"}},"üíù Morah left these for you!"),
React.createElement("div",{style:{flex:1,height:1,background:"rgba(255,105,180,.15)"}})),

// ‚îÄ‚îÄ 4 Daily Objects (2x2 grid) ‚Äî pink white cards ‚îÄ‚îÄ
React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},
...dailyModes.map((mId,i)=>{const md=MORAH_MODES[mId];const ro=ROOM_OBJECTS[mId];const locked=mId==="book"&&!dn;
return React.createElement("button",{key:mId,className:"mode-btn",onClick:()=>{if(locked){say("Finish quest first!");return}say(md.name+"!");setTimeout(()=>onMorah(mId),400)},
style:{background:locked?"rgba(200,180,190,.3)":"rgba(255,255,255,.85)",
border:locked?"1.5px solid rgba(200,180,190,.3)":`2px solid ${md.color}44`,
borderRadius:22,padding:"18px 12px",display:"flex",flexDirection:"column",alignItems:"center",gap:6,textAlign:"center",
opacity:locked?.4:1,animation:`slideUp .4s ease-out ${i*.08}s both`,
transition:"transform .2s ease,filter .2s ease",
boxShadow:locked?"none":`0 4px 15px ${md.color}20`}},
React.createElement("div",{style:{fontSize:42,animation:`float ${2.5+i*.3}s ease-in-out infinite`}},ro.obj),
React.createElement("div",{style:{fontSize:14,fontWeight:700,lineHeight:1.2,color:md.color}},md.name),
React.createElement("div",{style:{fontSize:10,color:"rgba(120,40,80,.4)"}},locked?"Finish quest üîí":ro.spot))})),

// ‚îÄ‚îÄ Bottom: See All link ‚îÄ‚îÄ
React.createElement("button",{onClick:()=>setShowAll(true),style:{background:"none",border:"none",fontSize:12,color:"rgba(120,40,80,.25)",padding:8,textAlign:"center"}},"See all activities")),

// ‚îÄ‚îÄ Days counter ‚îÄ‚îÄ
prog.days>0&&React.createElement("div",{style:{textAlign:"center",padding:"4px 0 12px",color:"rgba(220,120,170,.25)",fontSize:10,zIndex:2}},prog.days," days played"))
};
// ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê
const App=()=>{const[scr,setScr]=useState("login");const[prog,setProg]=useState(ld());const[qr,setQr]=useState([]);const[earn,setEarn]=useState(0);const[prz,setPrz]=useState(null);const[ns,setNs]=useState(null);const[curStory,setCurStory]=useState(null);const[morahMode,setMorahMode]=useState(null);

const handleLogin=()=>{initS();setScr("home")};

const finish=(r,details)=>{const ok=r.filter(Boolean).length;const e=ok*3;const nt=prog.stars+e;const np=PRIZES.find(p=>p.s<=nt&&p.s>prog.stars);
const nd=prog.last!==td();const str=nd?(prog.last===yd()?(prog.streak||0)+1:1):prog.streak;
let nstk=null;const stk=[...(prog.stk||[])];if(ok>=8){nstk=pick(STIX);stk.push(nstk)}
const sUnlocked=[...(prog.storiesUnlocked||[])];if(np&&np.t==="story"&&np.sid)sUnlocked.push(np.sid);
const np2={stars:nt,ok:prog.ok+ok,played:prog.played+20,streak:str,stk,storiesUnlocked:sUnlocked,last:td(),days:(prog.days||0)+(nd?1:0)};
setProg(np2);sv(np2);setQr(r);setEarn(e);setPrz(np||null);setNs(nstk);setScr("done");
recordSession(r,details,e,nstk,!nd);
if(np)setTimeout(()=>say("New prize! "+np.n),900)};

useEffect(()=>{syncCloud(setProg)},[]);

if(scr==="login")return React.createElement(PinLogin,{onLogin:handleLogin});
if(scr==="home")return React.createElement(Home,{prog,onQ:()=>setScr("quest"),onP:()=>setScr("prizes"),onMorah:m=>{setMorahMode(m);setScr("morahchat")}});
if(scr==="morahmenu")return React.createElement(MorahMenu,{questDone:prog.last===td(),onPick:m=>{setMorahMode(m);setScr("morahchat")},onBack:()=>setScr("home")});
if(scr==="morahchat"&&morahMode)return React.createElement(MorahChat,{mode:morahMode,onBack:()=>setScr("home")});
if(scr==="quest")return React.createElement(Quest,{onDone:finish,onBack:()=>setScr("home")});
if(scr==="done")return React.createElement(QDone,{res:qr,earned:earn,ns,prize:prz,streak:prog.streak,onHome:()=>setScr("home")});
if(scr==="prizes")return React.createElement(PrizePg,{prog,onBack:()=>setScr("home"),onStory:s=>{setCurStory(s);setScr("story")}});
if(scr==="story"&&curStory)return React.createElement(StoryReader,{story:curStory,onBack:()=>setScr("prizes")});
return null};

// Hide loader, show app
try{document.getElementById("loader").style.display="none"}catch{}

// Error boundary
class ErrBound extends React.Component{
constructor(p){super(p);this.state={err:null}}
static getDerivedStateFromError(e){return{err:e.message}}
render(){if(this.state.err)return React.createElement("div",{style:{padding:40,textAlign:"center",background:"#FFF0F5",minHeight:"100vh",fontFamily:"sans-serif",color:"#C050A0"}},
React.createElement("div",{style:{fontSize:60,marginBottom:20}},"üò¢"),
React.createElement("h2",null,"Oops! Something went wrong"),
React.createElement("p",{style:{fontSize:14,maxWidth:300,margin:"12px auto",color:"#999"}},this.state.err),
React.createElement("button",{onClick:()=>window.location.reload(),style:{background:"#FF69B4",color:"#fff",border:"none",borderRadius:20,padding:"12px 24px",fontSize:16,marginTop:20}},"Try Again"));
return this.props.children}
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(ErrBound,null,React.createElement(App)));
if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js').catch(()=>{})}
</script>
</body>
</html>
